(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{435:function(n,e,t){"use strict";t.r(e);var a=t(23),r=Object(a.a)({},(function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[t("h2",{attrs:{id:"简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[n._v("#")]),n._v(" 简介")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nginx.org/en/docs/",target:"_blank",rel:"noopener noreferrer"}},[n._v("Nginx"),t("OutboundLink")],1),n._v(" 作为数据传输过程中的一个节点（高性能的HTTP和反向代理服务器），具备提供Web Server、Proxy Server以及LoadBalancer的能力。")]),n._v(" "),t("p",[n._v("Nginx有一个master进程和若干worker进程，master进程负责读取相关配置、维护worker进程。worker进程负责实际处理请求。\n如果开启缓存，则缓存加载器及缓存管理进程也会在启动时运行。")]),n._v(" "),t("p",[n._v("Nginx采用基于事件的模型和与操作系统相关的实现机制，以便高效地为worker进程分配请求。（特点是占用内存少，并发能力强）")]),n._v(" "),t("p",[n._v("Nginx的工作方式取决于配置文件，默认的配置文件为"),t("code",[n._v("nginx.conf")]),n._v("，通常位于"),t("code",[n._v("/usr/local/nginx/conf")]),n._v("、"),t("code",[n._v("/etc/nginx")]),n._v("或"),t("code",[n._v("/usr/local/etc/nginx")]),n._v("目录中。")]),n._v(" "),t("h2",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[n._v("#")]),n._v(" 安装")]),n._v(" "),t("p",[t("a",{attrs:{href:"/it/devops/k8s/Nginx"}},[n._v("k8s--传送门")])]),n._v(" "),t("h2",{attrs:{id:"命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#命令"}},[n._v("#")]),n._v(" 命令")]),n._v(" "),t("p",[n._v("操作Nginx的指令很少，如下：")]),n._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[n._v("./nginx start\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# s-signal")]),n._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# fast shutdown")]),n._v("\n./nginx -s stop\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# graceful shutdown")]),n._v("\n./nginx -s quit\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# reloading the configuration file")]),n._v("\n./nginx -s reload\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# reopening the log files")]),n._v("\n./nginx -s reopen\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[n._v("# see version")]),n._v("\n./nginx -v\n")])])]),t("p",[n._v("重点说一下reload信号：")]),n._v(" "),t("p",[n._v("配置文件发生修改后，不会自动生效，除非使用"),t("code",[n._v("reload")]),n._v("命令或等到nginx重启。")]),n._v(" "),t("p",[n._v("当master进程收到"),t("code",[n._v("reload")]),n._v("配置文件后，它会检查最新的配置文件的内容的语法合法性。")]),n._v(" "),t("p",[n._v("如果验证成功，master会开启新的worker，同时给old worker发送信息，要求他们停止工作。")]),n._v(" "),t("p",[n._v("如果验证失败，master会仍使用之前的配置文件进行工作。")]),n._v(" "),t("h2",{attrs:{id:"配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[n._v("#")]),n._v(" 配置文件")]),n._v(" "),t("p",[n._v("Nginx的配置文件是模块化的，各模块由特定的指令组成。")]),n._v(" "),t("p",[n._v("指令分为简单指令和块指令。")]),n._v(" "),t("p",[n._v("简单指令包含指令名称和空格分割的参数，并以分号结尾。")]),n._v(" "),t("p",[n._v("块指令与简单指令的结构类似，但不以分号结尾，而是以"),t("code",[n._v("{}")]),n._v("块结尾。")]),n._v(" "),t("p",[n._v("如果块指令内部包含其他指令，则块指令又被成为context。不被任何context包含的指令，称它们位于main context。")]),n._v(" "),t("p",[n._v("例如"),t("code",[n._v("events")]),n._v("和"),t("code",[n._v("http")]),n._v("指令位于main context，"),t("code",[n._v("server")]),n._v("指令在http context，"),t("code",[n._v("location")]),n._v("指令在 server context。")]),n._v(" "),t("p",[n._v("除此之外，以#开头的行成为注释。")]),n._v(" "),t("p",[n._v("为了使配置更易于维护，我们建议您将其拆分为一组存储在 "),t("code",[n._v("/etc/nginx/conf.d")]),n._v(" 目录中的特定于功能的文件，在主 nginx.conf 文件中使用 "),t("code",[n._v("include")]),n._v(" 指令来引用特定于功能的文件的内容。")]),n._v(" "),t("h2",{attrs:{id:"作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用"}},[n._v("#")]),n._v(" 作用")]),n._v(" "),t("h3",{attrs:{id:"静态内容托管-虚拟主机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#静态内容托管-虚拟主机"}},[n._v("#")]),n._v(" 静态内容托管（虚拟主机）")]),n._v(" "),t("p",[n._v("静态内容（即不需要Web服务器进行二次加工即可响应返回的文件（html/js/css/图片））的托管，是Nginx的基础功能，以便资源能够在互联网上共享分发。")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://docs.nginx.com/nginx/admin-guide/web-server/web-server/",target:"_blank",rel:"noopener noreferrer"}},[n._v("http/server(listen/server_name)/location--传送门"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://docs.nginx.com/nginx/admin-guide/web-server/serving-static-content/",target:"_blank",rel:"noopener noreferrer"}},[n._v("root/index/autoindex/try_files--传送门"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://docs.nginx.com/nginx/admin-guide/web-server/compression/",target:"_blank",rel:"noopener noreferrer"}},[n._v("compression--传送门"),t("OutboundLink")],1)]),n._v(" "),t("h3",{attrs:{id:"反向代理-服务托管"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#反向代理-服务托管"}},[n._v("#")]),n._v(" 反向代理（服务托管）")]),n._v(" "),t("p",[n._v("由于具备优秀的高并发特性，Nginx通常会作为反向代理以实现流量聚合和请求分发。")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://docs.nginx.com/nginx/admin-guide/web-server/reverse-proxy/",target:"_blank",rel:"noopener noreferrer"}},[n._v("proxy_pass/proxy_set_header/proxy_bind--传送门"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[n._v("正向代理：代理客户端")])]),n._v("发送请求")],1),n._v(" "),t("imgv",{attrs:{v:"/img/it/devops/nginx1.png"}}),n._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[n._v("反向代理：代理服务器端")])]),n._v("接收请求")],1),n._v(" "),t("imgv",{attrs:{v:"/img/it/devops/nginx2.png"}}),n._v(" "),t("h3",{attrs:{id:"负载均衡-服务分流"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡-服务分流"}},[n._v("#")]),n._v(" 负载均衡（服务分流）")]),n._v(" "),t("p",[n._v("负载均衡是一种分流技术，将大量的客户端请求合理分发至不同的目标服务器，以降低各服务器的负载，保持系统整体的稳定性。")]),n._v(" "),t("ul",[t("li",[n._v("服务端负载均衡 ：Ngnix")]),n._v(" "),t("li",[n._v("客户端负载均衡：OpenFeign（通过Ribbon实现）")])]),n._v(" "),t("p",[t("a",{attrs:{href:"https://docs.nginx.com/nginx/admin-guide/load-balancer/http-load-balancer/",target:"_blank",rel:"noopener noreferrer"}},[n._v("upstream/weight/backup/least_conn/ip_hash/hash--传送门"),t("OutboundLink")],1)]),n._v(" "),t("p",[n._v("可选的负载均衡策略有：")]),n._v(" "),t("ol",[t("li",[n._v("Round Robin（支持server weight）\n"),t("ul",[t("li",[n._v("轮询server，同时考虑weight")])])]),n._v(" "),t("li",[n._v("least connections\n"),t("ul",[t("li",[n._v("代理给当前连接数最少的server")])])]),n._v(" "),t("li",[n._v("ip hash\n"),t("ul",[t("li",[n._v("基于客户端的ip地址，确定upstream的server")])])]),n._v(" "),t("li",[n._v("hash\n"),t("ul",[t("li",[n._v("基于客户端信息（ip、port、uri），确定upstream的server")])])]),n._v(" "),t("li",[n._v("least time（NGINX Plus only）")]),n._v(" "),t("li",[n._v("random（NGINX Plus only）")])]),n._v(" "),t("h2",{attrs:{id:"常用指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#常用指令"}},[n._v("#")]),n._v(" 常用指令")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nginx.org/en/docs/http/ngx_http_core_module.html#listen",target:"_blank",rel:"noopener noreferrer"}},[n._v("listen"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nginx.org/en/docs/ngx_core_module.html#include",target:"_blank",rel:"noopener noreferrer"}},[n._v("include"),t("OutboundLink")],1)]),n._v(" "),t("h2",{attrs:{id:"配置示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置示例"}},[n._v("#")]),n._v(" 配置示例")]),n._v(" "),t("div",{staticClass:"language-text extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[n._v('#####################    nginx.conf\n\n\nuser  www www;\nworker_processes  4;\n\nerror_log  /alidata/log/nginx/error.log crit;\npid        /alidata/server/nginx/logs/nginx.pid;\n\n#Specifies the value for maximum file descriptors that can be opened by this process. \nworker_rlimit_nofile 65535;\n\nevents \n{\n  use epoll;\n  worker_connections 65535;\n}\n\n\nhttp {\n\tinclude       mime.types;\n\tdefault_type  application/octet-stream;\n\n\t#charset  gb2312;\n\n\tserver_names_hash_bucket_size 128;\n\tclient_header_buffer_size 32k;\n\tlarge_client_header_buffers 4 32k;\n\tclient_max_body_size 8m;\n\n\tsendfile on;\n\ttcp_nopush     on;\n\n\tkeepalive_timeout 60;\n\n\ttcp_nodelay on;\n\n\tfastcgi_connect_timeout 300;\n\tfastcgi_send_timeout 300;\n\tfastcgi_read_timeout 300;\n\tfastcgi_buffer_size 64k;\n\tfastcgi_buffers 4 64k;\n\tfastcgi_busy_buffers_size 128k;\n\tfastcgi_temp_file_write_size 128k;\n\n\tgzip on;\n\tgzip_min_length  1k;\n\tgzip_buffers     4 16k;\n\tgzip_http_version 1.0;\n\tgzip_comp_level 2;\n\tgzip_types       text/plain application/x-javascript text/css application/xml;\n\tgzip_vary on;\n\t#limit_zone  crawler  $binary_remote_addr  10m;\n\tlog_format \'$remote_addr - $remote_user [$time_local] "$request" \'\n\t              \'$status $body_bytes_sent "$http_referer" \'\n\t              \'"$http_user_agent" "$http_x_forwarded_for"\';\n\tinclude /alidata/server/nginx/conf/vhosts/*.conf;\n}\n\n########################   mime.types\n\ntypes {\n    text/html                             html htm shtml;\n    text/css                              css;\n    text/xml                              xml;\n    image/gif                             gif;\n    image/jpeg                            jpeg jpg;\n    application/x-javascript              js;\n    application/atom+xml                  atom;\n    application/rss+xml                   rss;\n\n    text/mathml                           mml;\n    text/plain                            txt;\n    text/vnd.sun.j2me.app-descriptor      jad;\n    text/vnd.wap.wml                      wml;\n    text/x-component                      htc;\n\n    image/png                             png;\n    image/tiff                            tif tiff;\n    image/vnd.wap.wbmp                    wbmp;\n    image/x-icon                          ico;\n    image/x-jng                           jng;\n    image/x-ms-bmp                        bmp;\n    image/svg+xml                         svg svgz;\n    image/webp                            webp;\n\n    application/java-archive              jar war ear;\n    application/mac-binhex40              hqx;\n    application/msword                    doc;\n    application/pdf                       pdf;\n    application/postscript                ps eps ai;\n    application/rtf                       rtf;\n    application/vnd.ms-excel              xls;\n    application/vnd.ms-powerpoint         ppt;\n    application/vnd.wap.wmlc              wmlc;\n    application/vnd.google-earth.kml+xml  kml;\n    application/vnd.google-earth.kmz      kmz;\n    application/x-7z-compressed           7z;\n    application/x-cocoa                   cco;\n    application/x-java-archive-diff       jardiff;\n    application/x-java-jnlp-file          jnlp;\n    application/x-makeself                run;\n    application/x-perl                    pl pm;\n    application/x-pilot                   prc pdb;\n    application/x-rar-compressed          rar;\n    application/x-redhat-package-manager  rpm;\n    application/x-sea                     sea;\n    application/x-shockwave-flash         swf;\n    application/x-stuffit                 sit;\n    application/x-tcl                     tcl tk;\n    application/x-x509-ca-cert            der pem crt;\n    application/x-xpinstall               xpi;\n    application/xhtml+xml                 xhtml;\n    application/zip                       zip;\n\n    application/octet-stream              bin exe dll;\n    application/octet-stream              deb;\n    application/octet-stream              dmg;\n    application/octet-stream              eot;\n    application/octet-stream              iso img;\n    application/octet-stream              msi msp msm;\n\n    audio/midi                            mid midi kar;\n    audio/mpeg                            mp3;\n    audio/ogg                             ogg;\n    audio/x-m4a                           m4a;\n    audio/x-realaudio                     ra;\n\n    video/3gpp                            3gpp 3gp;\n    video/mp4                             mp4;\n    video/mpeg                            mpeg mpg;\n    video/quicktime                       mov;\n    video/webm                            webm;\n    video/x-flv                           flv;\n    video/x-m4v                           m4v;\n    video/x-mng                           mng;\n    video/x-ms-asf                        asx asf;\n    video/x-ms-wmv                        wmv;\n    video/x-msvideo                       avi;\n}\n\n\n################################  vhosts/webview.conf\nserver {\n        #监听端口\n        listen       80;\n       #server_name  47.104.79.114;\n        server_name  test.webview.qcsd99.com;\n        \n        location / {\n            try_files $uri $uri/ /findwhat/index.html;\n            root   /alidata/server/nginx-1.4.4/html;\n            index  index.html index.htm;\n\n        }\n\n        location /manage-merchant/ {\n            try_files $uri $uri/ /manage-merchant/index.html;\n            root   /alidata/server/nginx-1.4.4/html;\n            index  index.html index.htm;\n        }\n\n\t    location /orderPrinter {\n            try_files $uri $uri/ /orderPrinter/index.html;\n            root   /alidata/server/nginx-1.4.4/html/;\n        }        \n \n        error_page   500 502 503 504  /50x.html;\n        location = /50x.html {\n            root   /alidata/server/nginx-1.4.4/html;\n        }\n}\n\n')])])]),t("h2",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[n._v("#")]),n._v(" 参考")]),n._v(" "),t("p",[t("a",{attrs:{href:"https://nginx.org/en/docs/",target:"_blank",rel:"noopener noreferrer"}},[n._v("官网"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/u012068483/article/details/104442706",target:"_blank",rel:"noopener noreferrer"}},[n._v("Nginx工作原理及优化参数配置"),t("OutboundLink")],1)]),n._v(" "),t("p",[t("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/348921580",target:"_blank",rel:"noopener noreferrer"}},[n._v("Nginx超详细入门教程，收藏慢慢看"),t("OutboundLink")],1)])],1)}),[],!1,null,null,null);e.default=r.exports}}]);