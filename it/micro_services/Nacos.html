<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>归律诗书屋</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/js/base.js"></script>
    <meta name="description" content="规律是什么，应该做什么">
    
    <link rel="preload" href="/assets/css/0.styles.732cfe5a.css" as="style"><link rel="preload" href="/assets/js/app.9098f2d6.js" as="script"><link rel="preload" href="/assets/js/2.f664f0df.js" as="script"><link rel="preload" href="/assets/js/74.9a692a0b.js" as="script"><link rel="preload" href="/assets/js/4.7d1e3a27.js" as="script"><link rel="preload" href="/assets/js/10.f82cd603.js" as="script"><link rel="prefetch" href="/assets/js/100.0b017729.js"><link rel="prefetch" href="/assets/js/101.a32b7951.js"><link rel="prefetch" href="/assets/js/102.bc1b6c72.js"><link rel="prefetch" href="/assets/js/103.9f45dbec.js"><link rel="prefetch" href="/assets/js/104.c4d95740.js"><link rel="prefetch" href="/assets/js/11.f76fc40f.js"><link rel="prefetch" href="/assets/js/12.6944af50.js"><link rel="prefetch" href="/assets/js/13.b89150ac.js"><link rel="prefetch" href="/assets/js/14.1501f817.js"><link rel="prefetch" href="/assets/js/15.4ef0f2a7.js"><link rel="prefetch" href="/assets/js/16.120197c6.js"><link rel="prefetch" href="/assets/js/17.0e60bb83.js"><link rel="prefetch" href="/assets/js/18.2318b5c9.js"><link rel="prefetch" href="/assets/js/19.8bdd7690.js"><link rel="prefetch" href="/assets/js/20.4a833638.js"><link rel="prefetch" href="/assets/js/21.94094807.js"><link rel="prefetch" href="/assets/js/22.43cb76f6.js"><link rel="prefetch" href="/assets/js/23.c4100de5.js"><link rel="prefetch" href="/assets/js/24.13a694fe.js"><link rel="prefetch" href="/assets/js/25.73e7c270.js"><link rel="prefetch" href="/assets/js/26.cec4157b.js"><link rel="prefetch" href="/assets/js/27.3e6f7d78.js"><link rel="prefetch" href="/assets/js/28.50860f22.js"><link rel="prefetch" href="/assets/js/29.dade73f8.js"><link rel="prefetch" href="/assets/js/3.6afeda28.js"><link rel="prefetch" href="/assets/js/30.e415a951.js"><link rel="prefetch" href="/assets/js/31.245e1ff8.js"><link rel="prefetch" href="/assets/js/32.1c58c318.js"><link rel="prefetch" href="/assets/js/33.2a35dc80.js"><link rel="prefetch" href="/assets/js/34.928df80d.js"><link rel="prefetch" href="/assets/js/35.7caf1f6b.js"><link rel="prefetch" href="/assets/js/36.eef51210.js"><link rel="prefetch" href="/assets/js/37.daa3f442.js"><link rel="prefetch" href="/assets/js/38.eeffb529.js"><link rel="prefetch" href="/assets/js/39.95683b9b.js"><link rel="prefetch" href="/assets/js/40.7f72a5a5.js"><link rel="prefetch" href="/assets/js/41.d9074d14.js"><link rel="prefetch" href="/assets/js/42.efdc1f95.js"><link rel="prefetch" href="/assets/js/43.4d868b19.js"><link rel="prefetch" href="/assets/js/44.39f49c28.js"><link rel="prefetch" href="/assets/js/45.fed4a64f.js"><link rel="prefetch" href="/assets/js/46.81f4a3ca.js"><link rel="prefetch" href="/assets/js/47.a3bf6707.js"><link rel="prefetch" href="/assets/js/48.c6d93e94.js"><link rel="prefetch" href="/assets/js/49.8746a81f.js"><link rel="prefetch" href="/assets/js/5.2a0c43dc.js"><link rel="prefetch" href="/assets/js/50.7d5ec5b6.js"><link rel="prefetch" href="/assets/js/51.95b7c204.js"><link rel="prefetch" href="/assets/js/52.00a09d16.js"><link rel="prefetch" href="/assets/js/53.9524084e.js"><link rel="prefetch" href="/assets/js/54.1a8cc05a.js"><link rel="prefetch" href="/assets/js/55.71782b73.js"><link rel="prefetch" href="/assets/js/56.b947061b.js"><link rel="prefetch" href="/assets/js/57.11a9393e.js"><link rel="prefetch" href="/assets/js/58.c8fbf621.js"><link rel="prefetch" href="/assets/js/59.625314bf.js"><link rel="prefetch" href="/assets/js/6.c059e3e4.js"><link rel="prefetch" href="/assets/js/60.1ec17786.js"><link rel="prefetch" href="/assets/js/61.d4981987.js"><link rel="prefetch" href="/assets/js/62.d9540377.js"><link rel="prefetch" href="/assets/js/63.7ce35e41.js"><link rel="prefetch" href="/assets/js/64.48918d7f.js"><link rel="prefetch" href="/assets/js/65.407e96f4.js"><link rel="prefetch" href="/assets/js/66.6997bec9.js"><link rel="prefetch" href="/assets/js/67.c5e5f86c.js"><link rel="prefetch" href="/assets/js/68.ee64232e.js"><link rel="prefetch" href="/assets/js/69.dc92dff3.js"><link rel="prefetch" href="/assets/js/7.cf1c6bc8.js"><link rel="prefetch" href="/assets/js/70.7e22b5d4.js"><link rel="prefetch" href="/assets/js/71.15065321.js"><link rel="prefetch" href="/assets/js/72.3386bac8.js"><link rel="prefetch" href="/assets/js/73.fb724b18.js"><link rel="prefetch" href="/assets/js/75.202da1fd.js"><link rel="prefetch" href="/assets/js/76.70c1c8f8.js"><link rel="prefetch" href="/assets/js/77.70291f3f.js"><link rel="prefetch" href="/assets/js/78.b7cd50b7.js"><link rel="prefetch" href="/assets/js/79.3d7eb8e2.js"><link rel="prefetch" href="/assets/js/8.ff8ef414.js"><link rel="prefetch" href="/assets/js/80.ce8dffd6.js"><link rel="prefetch" href="/assets/js/81.c34c3904.js"><link rel="prefetch" href="/assets/js/82.9414052b.js"><link rel="prefetch" href="/assets/js/83.a2da1a0a.js"><link rel="prefetch" href="/assets/js/84.589d3fe4.js"><link rel="prefetch" href="/assets/js/85.40a5ab61.js"><link rel="prefetch" href="/assets/js/86.03d4caec.js"><link rel="prefetch" href="/assets/js/87.5bfbb8de.js"><link rel="prefetch" href="/assets/js/88.d63f9a15.js"><link rel="prefetch" href="/assets/js/89.31f30592.js"><link rel="prefetch" href="/assets/js/9.46c773a8.js"><link rel="prefetch" href="/assets/js/90.82e6bbde.js"><link rel="prefetch" href="/assets/js/91.e6ef02dd.js"><link rel="prefetch" href="/assets/js/92.485a3afc.js"><link rel="prefetch" href="/assets/js/93.80da4442.js"><link rel="prefetch" href="/assets/js/94.69591e93.js"><link rel="prefetch" href="/assets/js/95.b233d915.js"><link rel="prefetch" href="/assets/js/96.8205937d.js"><link rel="prefetch" href="/assets/js/97.420c1537.js"><link rel="prefetch" href="/assets/js/98.41c37eae.js"><link rel="prefetch" href="/assets/js/99.51e246dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.732cfe5a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="归律诗书屋" class="logo"> <span class="site-name can-hide">归律诗书屋</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/it/" class="nav-link router-link-active">
  编程
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  万卷书
</a></div><div class="nav-item"><a href="/poetry/" class="nav-link">
  格律诗
</a></div><div class="nav-item"><a href="/meitu/" class="nav-link">
  美图
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用" class="dropdown-title"><span class="title">常用</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用" class="mobile-dropdown-title"><span class="title">常用</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cn.bing.com/?mkt=zh-CN&amp;mkt=zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  必应
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://translate.google.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://stock.tuchong.com/topic?topicId=50044&amp;from=Adobe%E7%8B%AC%E5%AE%B6" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图虫
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.zhouzhiyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  周志远
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baiyunju.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  白云居
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人" class="dropdown-title"><span class="title">个人</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人" class="mobile-dropdown-title"><span class="title">个人</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/misc/2022.html" class="nav-link">
  思记
</a></li><li class="dropdown-item"><!----> <a href="/misc/口语表达.html" class="nav-link">
  口语表达
</a></li><li class="dropdown-item"><!----> <a href="/life/UnusualThinking.html" class="nav-link">
  二般思维
</a></li><li class="dropdown-item"><!----> <a href="/misc/AboutMe.html" class="nav-link">
  狼与羊
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/it/" class="nav-link router-link-active">
  编程
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  万卷书
</a></div><div class="nav-item"><a href="/poetry/" class="nav-link">
  格律诗
</a></div><div class="nav-item"><a href="/meitu/" class="nav-link">
  美图
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用" class="dropdown-title"><span class="title">常用</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用" class="mobile-dropdown-title"><span class="title">常用</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cn.bing.com/?mkt=zh-CN&amp;mkt=zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  必应
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://translate.google.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://stock.tuchong.com/topic?topicId=50044&amp;from=Adobe%E7%8B%AC%E5%AE%B6" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图虫
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.zhouzhiyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  周志远
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baiyunju.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  白云居
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人" class="dropdown-title"><span class="title">个人</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人" class="mobile-dropdown-title"><span class="title">个人</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/misc/2022.html" class="nav-link">
  思记
</a></li><li class="dropdown-item"><!----> <a href="/misc/口语表达.html" class="nav-link">
  口语表达
</a></li><li class="dropdown-item"><!----> <a href="/life/UnusualThinking.html" class="nav-link">
  二般思维
</a></li><li class="dropdown-item"><!----> <a href="/misc/AboutMe.html" class="nav-link">
  狼与羊
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>不只是编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>微服务</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/it/micro_services/架构演化历史.html" class="sidebar-link">架构演化历史</a></li><li><a href="/it/micro_services/微服务解决方案.html" class="sidebar-link">微服务解决方案</a></li><li><a href="/it/devops/Maven.html" class="sidebar-link">统一依赖管理</a></li><li><a href="/it/micro_services/SpringCloudGateway.html" class="sidebar-link">聚合网关·Gateway</a></li><li><a href="/it/micro_services/Nacos.html" aria-current="page" class="active sidebar-link">注册中心·Nacos</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#概述" class="sidebar-link">概述</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#架构及概念" class="sidebar-link">架构及概念</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#源码安装" class="sidebar-link">源码安装</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#压缩包安装" class="sidebar-link">压缩包安装</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#docker安装" class="sidebar-link">Docker安装</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#k8s" class="sidebar-link">k8s</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#mysql存储" class="sidebar-link">MySql存储</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#登录管理" class="sidebar-link">登录管理</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#服务注册中心-服务发现" class="sidebar-link">服务注册中心（服务发现）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#服务提供者" class="sidebar-link">服务提供者</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#服务消费者-loadbalancer" class="sidebar-link">服务消费者-LoadBalancer</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#服务消费者-feign" class="sidebar-link">服务消费者-Feign</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#配置管理中心-配置管理" class="sidebar-link">配置管理中心（配置管理）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#什么是配置" class="sidebar-link">什么是配置</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#什么是配置中心" class="sidebar-link">什么是配置中心</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#nacos配置数据模型" class="sidebar-link">Nacos配置数据模型</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#dataid组成" class="sidebar-link">dataId组成</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#发布配置" class="sidebar-link">发布配置</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#application-xxx-bootstrap-xxx" class="sidebar-link">application.xxx--&gt;bootstrap.xxx</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#使用配置" class="sidebar-link">使用配置</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#实时更新" class="sidebar-link">实时更新</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#自定义配置dataid" class="sidebar-link">自定义配置dataId</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#共享配置" class="sidebar-link">共享配置</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#默认-扩展-共享配置" class="sidebar-link">默认&gt;扩展&gt;共享配置</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#关闭配置中心" class="sidebar-link">关闭配置中心</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#本地配置覆盖远程配置" class="sidebar-link">本地配置覆盖远程配置</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#nacos内存调优" class="sidebar-link">Nacos内存调优</a></li><li class="sidebar-sub-header"><a href="/it/micro_services/Nacos.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/it/micro_services/Ribbon.html" class="sidebar-link">负载均衡·Ribbon</a></li><li><a href="/it/micro_services/Feign.html" class="sidebar-link">同步通信·Feign</a></li><li><a href="/it/micro_services/Dubbo.html" class="sidebar-link">同步通信·Dubbo</a></li><li><a href="/it/micro_services/RabbitMQ.html" class="sidebar-link">异步通信·RabbitMQ</a></li><li><a href="/it/micro_services/Sentinel.html" class="sidebar-link">流控降级·Sentinel</a></li><li><a href="/it/micro_services/SkyWalking.html" class="sidebar-link">链路追踪·SkyWalking</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DevOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Android</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>领域模型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具箱</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://pangniao.net/page/7/" target="_blank" rel="noopener noreferrer" class="sidebar-link">胖鸟<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/it/tool/科学上网.html" class="sidebar-link">科学上网</a></li><li><a href="https://www.youhou8.com/users/max/scripts" target="_blank" rel="noopener noreferrer" class="sidebar-link">油猴<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://www.liantu.com/?123=http://qcsd-web-dev.oss-cn-qingdao.aliyuncs.com/" target="_blank" rel="noopener noreferrer" class="sidebar-link">二维码生成<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><div class="custom-block tip"><p class="custom-block-title">服务注册中心</p> <p>Nacos是构建以“服务”为中心的现代应用架构的基础服务设施，致力于帮助您注册/发现、配置和管理微服务。</p></div> <img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos1.png" data-v-2a6bf9e1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>按照微服务的架构思想，按照业务将单体应用拆分为不同的服务。那么问题来了，这么多服务，如何治理呢（服务之间如何发现/服务的上下线如何通知）？</p> <p>Spring Cloud Alibaba给出的方案使用Nacos作为微服务架构的服务注册中心，用以替代Spring Cloud Netflix 的 Eureka。</p> <p>除此之外，Nacos还兼具Spring Cloud Config的作用，即作为独立的配置中心，为各服务提供统一的配置管理服务。</p> <h2 id="架构及概念"><a href="#架构及概念" class="header-anchor">#</a> 架构及概念</h2> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-architecture.jpeg"></div> <p><strong>服务 (Service)</strong>:指一个或一组软件功能（例如特定信息的检索或一组操作的执行）</p> <p><strong>服务注册中心 (Service Registry)</strong>:是服务的实例及元数据的数据库。服务实例在启动时注册到服务注册表，并在关闭时注销。</p> <p><strong>配置 (Configuration)</strong>：通常会将一些需要变更的参数、变量等从代码中分离出来独立管理，以独立的配置文件的形式存在。配置变更是调整系统运行时的行为的有效手段之一。</p> <p><strong>配置管理 (Configuration Management)</strong>：所有配置的编辑、存储、分发、历史版本管理等所有与配置相关的活动统称为配置管理。</p> <p><strong>名字服务 (Naming Service)</strong>：提供分布式系统中所有对象/实体的“名字”到关联的元数据（如ip地址）之间的映射管理服务</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p><a href="https://nacos.io/zh-cn/docs/quick-start.html" target="_blank" rel="noopener noreferrer">安装手册--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="源码安装"><a href="#源码安装" class="header-anchor">#</a> 源码安装</h3> <p><font color="red">Maven也是有Profile的功能的，与Spring 的Profile是类似的、相通的。</font></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/alibaba/nacos.git
<span class="token builtin class-name">cd</span> nacos/
<span class="token comment"># -P 指定profile使用release-nacos</span>
<span class="token comment"># -U 强制更新依赖</span>
mvn -Prelease-nacos -Dmaven.test.skip<span class="token operator">=</span>true clean <span class="token function">install</span> -U  
<span class="token function">ls</span> -al distribution/target/
</code></pre></div><h3 id="压缩包安装"><a href="#压缩包安装" class="header-anchor">#</a> 压缩包安装</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">unzip</span> nacos-server-<span class="token variable">$version</span>.zip 或者 <span class="token function">tar</span> -xvf nacos-server-<span class="token variable">$version</span>.tar.gz
<span class="token builtin class-name">cd</span> nacos/bin
</code></pre></div><h3 id="docker安装"><a href="#docker安装" class="header-anchor">#</a> Docker安装</h3> <p><a href="https://nacos.io/zh-cn/docs/quick-start-docker.html" target="_blank" rel="noopener noreferrer">nacos-docker-传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="k8s"><a href="#k8s" class="header-anchor">#</a> k8s</h3> <p><a href="/it/devops/k8s/Nacos">nacos-k8s-传送门</a></p> <h3 id="mysql存储"><a href="#mysql存储" class="header-anchor">#</a> MySql存储</h3> <p>在0.7版本之前，在单机模式时nacos使用嵌入式数据库实现数据的存储，不方便观察数据存储的基本情况。 0.7版本增加了支持mysql数据源能力，具体的操作步骤：</p> <ul><li>安装数据库，版本要求：5.6.5+</li> <li>初始化mysql数据库，数据库初始化文件：nacos-mysql.sql</li> <li>修改conf/application.properties文件，增加支持mysql数据源配置（目前只支持mysql），添加mysql数据源的url、用户名和密码。</li></ul> <div class="language-text extra-class"><pre class="language-text"><code>spring.datasource.platform=mysql

db.num=1
db.url.0=jdbc:mysql://11.162.196.16:3306/nacos_devtest?characterEncoding=utf8&amp;amp;connectTimeout=1000&amp;amp;socketTimeout=3000&amp;amp;autoReconnect=true
db.user=nacos_devtest
db.password=youdontknow
</code></pre></div><p>再以单机模式启动nacos，nacos所有写嵌入式数据库的数据都写到了mysql</p> <h3 id="登录管理"><a href="#登录管理" class="header-anchor">#</a> 登录管理</h3> <p>Nacos0.8 版本支持简单登录功能，默认用户名/密码为： nacos/nacos。</p> <h4 id="密码生成"><a href="#密码生成" class="header-anchor">#</a> 密码生成</h4> <p>生成加密密码，在<code>com.alibaba.nacos.console.utils.PasswordEncoderUtil.main</code>函数中，将 nacos 改成你要改成的密码，运行即可得到加密有算法。
注意盐值是随机的，所以生成密码每次可能不一样。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PasswordEncoderUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BCryptPasswordEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">&quot;nacos&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="用户-用户名修改"><a href="#用户-用户名修改" class="header-anchor">#</a> 用户/用户名修改</h4> <p>创建用户名或者密码的时候，用指定用户名密码即可。</p> <p>修改密码，增加用户需要直接修改数据库（nacos-user相关的表）。</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> users <span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> enabled<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'nacos'</span><span class="token punctuation">,</span> <span class="token string">'$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu'</span><span class="token punctuation">,</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> roles <span class="token punctuation">(</span>username<span class="token punctuation">,</span> role<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'nacos'</span><span class="token punctuation">,</span> <span class="token string">'ROLE_ADMIN'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="服务注册中心-服务发现"><a href="#服务注册中心-服务发现" class="header-anchor">#</a> 服务注册中心（服务发现）</h2> <h3 id="服务提供者"><a href="#服务提供者" class="header-anchor">#</a> 服务提供者</h3> <h4 id="添加依赖"><a href="#添加依赖" class="header-anchor">#</a> 添加依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 阿里巴巴 服务发现--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--                声明入口类--&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span>com.xxx.yyy.GatewayServiceApplication<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-dependency-discovery.png"></div> <h4 id="启动类"><a href="#启动类" class="header-anchor">#</a> 启动类</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 使用Spring Cloud的原生注解，降低侵入性
 */</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GatewayServiceApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">GatewayServiceApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><h4 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">applicatin</span><span class="token punctuation">:</span>
    <span class="token comment"># 服务名称必填，因为Nacos就是根据服务的名称进行注册和发现的</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nacos<span class="token punctuation">-</span>provider
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>

<span class="token comment"># 健康 检查暴露点的链接</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">&quot;*&quot;</span>
</code></pre></div><h4 id="端点检查"><a href="#端点检查" class="header-anchor">#</a> 端点检查</h4> <p>配置文件中的 <code>management:endpoints</code>的作用是实现服务提供者自身的端点检查：暴露服务提供者自身的一些信息数据。</p> <p><code>spring-cloud-starter-alibaba-nacos-discovery</code>在实现的时候提供了一个Endpoint，
Endpoint的访问地址为<code>http://ip:port/actuator/nacos-discovery</code>， Endpoint提供的信息有：</p> <ol><li>subscribe：显示了当前有哪些服务订阅者</li> <li>NacosDiscoveryProperties：显示当前服务实例关于Nacos的基础配置</li></ol> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;subscribe&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;NacosDiscoveryProperties&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;serverAddr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.3.110:30848&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;username&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;password&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;endpoint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;namespace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;c54b44d1-4ffe-4c8b-835d-ab314d57791d&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;watchDelay&quot;</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
    <span class="token property">&quot;logName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;service&quot;</span><span class="token operator">:</span> <span class="token string">&quot;base-server&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;weight&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clusterName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DEFAULT&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;group&quot;</span><span class="token operator">:</span> <span class="token string">&quot;DEFAULT_GROUP&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;namingLoadCacheAtStart&quot;</span><span class="token operator">:</span> <span class="token string">&quot;false&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;metadata&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;preserved.register.source&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SPRING_CLOUD&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;registerEnabled&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ip&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192.168.3.138&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;networkInterface&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">9100</span><span class="token punctuation">,</span>
    <span class="token property">&quot;secure&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;accessKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;secretKey&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;heartBeatInterval&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;heartBeatTimeout&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ipDeleteTimeout&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><font color="red">如果访问actuator/nacos-discovery接口无法查看相关信息，则如要添加下面的依赖</font></p> <div class="language-xml extra-class"><pre class="language-xml"><code>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="服务消费者-loadbalancer"><a href="#服务消费者-loadbalancer" class="header-anchor">#</a> 服务消费者-LoadBalancer</h3> <p>服务消费者的创建与服务提供者类似，这里采用最原始的一种方式，即显式地使用LoadBalanceClient和RestTemplate结合的方式来访问。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">MXBean</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConsumerConfiguration</span> <span class="token punctuation">{</span>

    <span class="token comment">// @LoadBalanced 直接使用该注解，则restTemplate具备负载均衡的能力，也可以使用下文的 LoadBalancerClient API来实现</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><font color="red">而LoadBalancerClient是通过<code>FeignRibbonClientAutoConfiguration</code>自动配置类声明到容器中的。</font></p> <p>因此需要添加依赖如下</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- openfeign --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-loadbalancer1.png"></div> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-loadbalancer2.png"></div> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConsumerController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">LoadBalancerClient</span> loadBalancerClient<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${spring.application.name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/echo&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServiceInstance</span> instance <span class="token operator">=</span> loadBalancerClient<span class="token punctuation">.</span><span class="token function">choose</span><span class="token punctuation">(</span><span class="token string">&quot;nacos-provider&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;http://%s:%s/echo&quot;</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span><span class="token function">getHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> instance<span class="token punctuation">.</span><span class="token function">getPort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> restTemplate<span class="token punctuation">.</span><span class="token function">getForObject</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="服务消费者-feign"><a href="#服务消费者-feign" class="header-anchor">#</a> 服务消费者-Feign</h3> <p><a href="/it/micro_services/Feign.html">Feign是一个声明式的伪Http客户端，它使得写Http客户端变得简单--传送门</a> ，Nacos很好的兼容了Feign。</p> <h4 id="增加依赖"><a href="#增加依赖" class="header-anchor">#</a> 增加依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- openfeign --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="启动类-2"><a href="#启动类-2" class="header-anchor">#</a> 启动类</h4> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@EnableFeignClients</span>
<span class="token annotation punctuation">@EnableFeignClients</span><span class="token punctuation">(</span>basePackages <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">&quot;com.qcsd.*&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;com.qcsd99.*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WangdiantongServiceApplication</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">WangdiantongServiceApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="声明feignservice"><a href="#声明feignservice" class="header-anchor">#</a> 声明FeignService</h4> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-feign-1.png"></div> <h4 id="调用feignservice"><a href="#调用feignservice" class="header-anchor">#</a> 调用FeignService</h4> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-feign-2.png"></div> <h2 id="配置管理中心-配置管理"><a href="#配置管理中心-配置管理" class="header-anchor">#</a> 配置管理中心（配置管理）</h2> <h3 id="什么是配置"><a href="#什么是配置" class="header-anchor">#</a> 什么是配置</h3> <ul><li>配置是独立于程序的只读变量</li> <li>配置伴随应用的整个生命周期</li> <li>配置可以有多种加载方式
<ul><li>程序硬编码</li> <li>配置文件</li> <li>环境变量</li> <li>启动参数</li> <li>基于数据库</li></ul></li> <li>配置需要治理
<ul><li>同一份程序在不同的环境（开发、测试、生产）、不同的集群（如不同的数据中心）需要有不同的配置，所以需要有完善的环境、集群配置管理</li></ul></li> <li>配置需要变更
<ul><li>配置变更是调整系统运行时的行为的有效手段</li></ul></li></ul> <p>配置可以分为两类：</p> <ol><li>工程配置
<ul><li>启动参数</li> <li>数据库地址及账号密码</li></ul></li> <li>业务配置
<ul><li>短信验证码的有效时间</li></ul></li></ol> <h3 id="什么是配置中心"><a href="#什么是配置中心" class="header-anchor">#</a> 什么是配置中心</h3> <p>在分布式系统中，由于服务数量巨多，为了方便配置文件<font color="red"><strong>统一管理，实时更新</strong></font>，所以需要分布式配置中心组件。</p> <h3 id="nacos配置数据模型"><a href="#nacos配置数据模型" class="header-anchor">#</a> Nacos配置数据模型</h3> <p>Nacos 数据模型 Key 由三元组唯一确定, Namespace默认是空串，公共命名空间（public），分组默认是 DEFAULT_GROUP。</p> <p>对于Nacos配置管理，通过Namespace（对环境的隔离）、group（配置文件的逻辑分组：dev/test/prod环境）、Data ID（文件名称）能够定位到一个配置集（配置文件）</p> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-model1.jpeg"></div> <p>围绕配置，主要有两个关联的实体，一个是配置变更历史，一个是服务标签（用于打标分类，方便索引），由 ID 关联。</p> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-model2.jpeg"></div> <h3 id="dataid组成"><a href="#dataid组成" class="header-anchor">#</a> dataId组成</h3> <p>在 Nacos Spring Cloud 中，dataId 的完整格式如下</p> <div class="language-text extra-class"><pre class="language-text"><code>${prefix}-${spring.profiles.active}.${file-extension}
</code></pre></div><ul><li>prefix 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li> <li><code>spring.profiles.active</code> 即为当前环境对应的 profile。 注意：当 <code>spring.profiles.active</code> 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></li> <li><code>file-extension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 properties 和 yaml 类型。</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> wangdiantong<span class="token punctuation">-</span>server
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token comment"># 配置中心</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token comment"># 服务中心地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>nacos.server<span class="token punctuation">-</span>addr<span class="token punctuation">}</span>
        <span class="token comment"># 默认前缀</span>
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>application
        <span class="token comment"># 文件类型</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yml
        <span class="token comment"># 命名空间（服务组别）</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>nacos.namespace<span class="token punctuation">}</span>
</code></pre></div><p>实际做项目的时候，生产环境和测试环境的一些配置可能会不一样，有时候一些功能也可能会不一样，所以可能会在上线的时候手工修改这些配置信息。</p> <p>但Spring中提供了profile这个功能，只需要在启动的时候添加虚拟机参数，激活当前环境所需的profile就可以了。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>java -Xms128m -Xmx256m -javaagent:/skywalking-agent-assembly-8.7.0/skywalking-agent.jar -Dskywalking.agent.service_name<span class="token operator">=</span>findwhat  -Dspring
.profiles.active<span class="token operator">=</span>dev  -Dnacos.server-addr<span class="token operator">=</span>nacos:8848 -Dproject.name<span class="token operator">=</span>findwhat -jar /app.jar
</code></pre></div><h3 id="发布配置"><a href="#发布配置" class="header-anchor">#</a> 发布配置</h3> <p>规划好Namespace和Group后，即可发布配置</p> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/micro_services/nacos-config-publish.png"></div> <h3 id="application-xxx-bootstrap-xxx"><a href="#application-xxx-bootstrap-xxx" class="header-anchor">#</a> application.xxx--&gt;bootstrap.xxx</h3> <p>创建名为<code>bootstrap.properties</code>的配置文件并删除<code>application.yml</code>。</p> <p>SpringBoot的配置文件的加载顺序依次为:</p> <ol><li><code>bootstrap.properties</code></li> <li><code>bootstrap.yml</code></li> <li><code>application.properties</code></li> <li><code>application.yml</code></li></ol> <p>其中，<code>bootstrap.properties</code>配置为最高优先级</p> <h3 id="使用配置"><a href="#使用配置" class="header-anchor">#</a> 使用配置</h3> <h4 id="增加依赖-2"><a href="#增加依赖-2" class="header-anchor">#</a> 增加依赖</h4> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token comment">&lt;!-- 阿里巴巴 配置中心--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="指定nacos配置文件"><a href="#指定nacos配置文件" class="header-anchor">#</a> 指定Nacos配置文件</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> wangdiantong<span class="token punctuation">-</span>server
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment"># 服务治理</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token comment"># 配置中心</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token comment"># 配置中心地址 ，由于 nacos-discovery和nacos-config可以独立部署，因此server-addr在config/discovery需要分别配置</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>nacos.server<span class="token punctuation">-</span>addr<span class="token punctuation">}</span>
        <span class="token comment"># 文件类型</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yml
</code></pre></div><h4 id="使用-value注解注入"><a href="#使用-value注解注入" class="header-anchor">#</a> 使用@Value注解注入</h4> <div class="language-java extra-class"><pre class="language-java"><code>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${user.name}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;name is &quot;</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="实时更新"><a href="#实时更新" class="header-anchor">#</a> 实时更新</h3> <p>单独使用<code>@Value</code>注解注入的方式，加载的Nacos的值是无法修改的。如果Nacos中的配置信息修改了，只能重启项目。</p> <p>下面三种方式，可以实时获取Nacos配置文件中的最新值。</p> <p><a href="https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html" target="_blank" rel="noopener noreferrer">RefreshScope--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://nacos.io/zh-cn/docs/quick-start-spring-boot.html" target="_blank" rel="noopener noreferrer">NacosValue--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>前提是<strong>保证</strong> <code>spring.cloud.nacos.config.refresh.enabled=true</code>。也就是说，可以通过<code>spring.cloud.nacos.config.refresh.enabled=false</code>来<strong>关闭动态刷新</strong>。</p> <h4 id="增加-refreshscope注解"><a href="#增加-refreshscope注解" class="header-anchor">#</a> 增加@RefreshScope注解</h4> <p>通过 Spring Cloud 原生注解 <code>@RefreshScope</code> 实现配置自动更新</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/config&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${useLocalCache:false}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> useLocalCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> useLocalCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用-nacosvalue"><a href="#使用-nacosvalue" class="header-anchor">#</a> 使用@NacosValue</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Controller</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;config&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NacosValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;${useLocalCache:false}&quot;</span><span class="token punctuation">,</span> autoRefreshed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> useLocalCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;/get&quot;</span><span class="token punctuation">,</span> method <span class="token operator">=</span> GET<span class="token punctuation">)</span>
    <span class="token annotation punctuation">@ResponseBody</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> useLocalCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="使用configurableapplicationcontext"><a href="#使用configurableapplicationcontext" class="header-anchor">#</a> 使用ConfigurableApplicationContext</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosConfigController</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">ConfigurableApplicationContext</span> applicationContext<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;name is &quot;</span> <span class="token operator">+</span> applicationContext<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">&quot;user.name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="自定义配置dataid"><a href="#自定义配置dataid" class="header-anchor">#</a> 自定义配置dataId</h3> <p>Spring Cloud Alibaba Nacos Config 从 0.2.1 版本后，可支持自定义 Data Id 的配置。</p> <div class="language-text extra-class"><pre class="language-text"><code>spring.application.name=opensource-service-provider
spring.cloud.nacos.config.server-addr=127.0.0.1:8848

# config external configuration
# 1、Data Id 在默认的组 DEFAULT_GROUP,不支持配置的动态刷新
spring.cloud.nacos.config.extension-configs[0].data-id=ext-config-common01.properties

# 2、Data Id 不在默认的组，不支持动态刷新
spring.cloud.nacos.config.extension-configs[1].data-id=ext-config-common02.properties
spring.cloud.nacos.config.extension-configs[1].group=GLOBALE_GROUP

# 3、Data Id 既不在默认的组，也支持动态刷新
spring.cloud.nacos.config.extension-configs[2].data-id=ext-config-common03.properties
spring.cloud.nacos.config.extension-configs[2].group=REFRESH_GROUP
spring.cloud.nacos.config.extension-configs[2].refresh=true
</code></pre></div><ul><li><code>通过 spring.cloud.nacos.config.extension-configs[n].data-id</code> 的配置方式来支持多个 Data Id 的配置。</li> <li><code>通过 spring.cloud.nacos.config.extension-configs[n].group</code> 的配置方式自定义 Data Id 所在的组，不明确配置的话，默认是 <code>DEFAULT_GROUP</code>。</li> <li><code>通过 spring.cloud.nacos.config.extension-configs[n].refresh</code> 的配置方式来控制该 Data Id 在配置变更时，是否支持应用中可动态刷新， 感知到最新的配置值。默认是不支持的。</li> <li>多个 Data Id 同时配置时，他的优先级关系是 <code>spring.cloud.nacos.config.extension-configs[n].data-id</code> 其中 n 的值越大，优先级越高。</li> <li><code>spring.cloud.nacos.config.extension-configs[n].data-id</code> 的值必须带文件扩展名，文件扩展名既可支持 <code>properties</code>，又可以支持 <code>yaml/yml</code>。 此时 <code>spring.cloud.nacos.config.file-extension</code> 的配置对自定义扩展配置的 Data Id 文件扩展名没有影响。</li></ul> <h3 id="共享配置"><a href="#共享配置" class="header-anchor">#</a> 共享配置</h3> <p>为了更加清晰的在多个应用间配置共享的 Data Id ，你可以通过以下的方式来配置：</p> <div class="language-text extra-class"><pre class="language-text"><code># 配置支持共享的 Data Id
spring.cloud.nacos.config.shared-configs[0].data-id=common.yaml

# 配置 Data Id 所在分组，缺省默认 DEFAULT_GROUP
spring.cloud.nacos.config.shared-configs[0].group=GROUP_APP1

# 配置Data Id 在配置变更时，是否动态刷新，缺省默认 false
spring.cloud.nacos.config.shared-configs[0].refresh=true
</code></pre></div><ul><li>通过 <code>spring.cloud.nacos.config.shared-configs[n].data-id</code> 来支持多个共享 Data Id 的配置。</li> <li>通过 <code>spring.cloud.nacos.config.shared-configs[n].group</code> 来配置自定义 Data Id 所在的组，不明确配置的话，默认是 <code>DEFAULT_GROUP</code>。</li> <li>通过 <code>spring.cloud.nacos.config.shared-configs[n].refresh</code> 来控制该Data Id在配置变更时，是否支持应用中动态刷新，默认<code>false</code></li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> wangdiantong<span class="token punctuation">-</span>server
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token comment"># 配置中心</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token comment"># 默认前缀，这个主要用于 启动配置</span>
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span><span class="token punctuation">-</span>application
        <span class="token comment"># 服务中心地址</span>
        <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>nacos.server<span class="token punctuation">-</span>addr<span class="token punctuation">}</span>
        <span class="token comment"># 命名空间（服务组别）</span>
        <span class="token key atrule">namespace</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>nacos.namespace<span class="token punctuation">}</span>
        <span class="token comment"># 文件类型</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yml
        <span class="token comment"># 共享的扩展配置</span>
        <span class="token key atrule">shared-configs</span><span class="token punctuation">:</span> common<span class="token punctuation">-</span>conf<span class="token punctuation">-</span>$<span class="token punctuation">{</span>spring.profiles.active<span class="token punctuation">}</span>.yml
</code></pre></div><h3 id="默认-扩展-共享配置"><a href="#默认-扩展-共享配置" class="header-anchor">#</a> 默认&gt;扩展&gt;共享配置</h3> <p>Spring Cloud Alibaba Nacos Config 目前提供了三种配置能力从 Nacos 拉取相关的配置。</p> <p>A: 通过 <code>spring.cloud.nacos.config.shared-configs[n].data-id</code> 支持多个共享 Data Id 的配置</p> <p>B: 通过 <code>spring.cloud.nacos.config.extension-configs[n].data-id</code> 的方式支持多个扩展 Data Id 的配置</p> <p>C: 通过内部相关规则(应用名、应用名+ Profile )自动生成相关的 Data Id 配置</p> <p>当三种方式共同使用时，他们的一个优先级关系是:A &lt; B &lt; C</p> <h3 id="关闭配置中心"><a href="#关闭配置中心" class="header-anchor">#</a> 关闭配置中心</h3> <p>通过设置 <code>spring.cloud.nacos.config.enabled = false</code> 来完全关闭 Spring Cloud Nacos Config。</p> <h2 id="本地配置覆盖远程配置"><a href="#本地配置覆盖远程配置" class="header-anchor">#</a> 本地配置覆盖远程配置</h2> <p><a href="https://cloud.tencent.com/developer/article/1083139" target="_blank" rel="noopener noreferrer">Spring Cloud 覆写远端的配置属性--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://stackoverflow.com/questions/43800256/how-spring-cloud-config-use-local-property-override-remote-property" target="_blank" rel="noopener noreferrer">how-spring-cloud-config-use-local-property-override-remote-property--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>应用的配置源通常都是远端的Config Server服务器，默认情况下，本地的配置优先级低于远端配置仓库。如果想实现本地应用的系统变量和config文件覆盖远端仓库中的属性值，可以通过如下设置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
      <span class="token comment"># 表明外部配置是否允许被覆盖  true：允许被覆盖  false：不允许被覆盖</span>
      <span class="token key atrule">allowOverride</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token comment"># 当allowOverride为true的时候， 表明外部属性具有最低优先级，不应该覆盖任何已存在的配置源（包括本地配置文件），默认false  true：外部配置具有最低优先级</span>
      <span class="token key atrule">overrideNone</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token comment"># 表明外部数据源应该覆盖系统属性，默认是true</span>
      <span class="token key atrule">overrideSystemProperties</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token string">&quot;spring.cloud.config&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PropertySourceBootstrapProperties</span> <span class="token punctuation">{</span>

	<span class="token comment">/**
	 * Flag to indicate that the external properties should override system properties.
	 * Default true.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> overrideSystemProperties <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Flag to indicate that {@link #isOverrideSystemProperties()
	 * systemPropertiesOverride} can be used. Set to false to prevent users from changing
	 * the default accidentally. Default true.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> allowOverride <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Flag to indicate that when {@link #setAllowOverride(boolean) allowOverride} is
	 * true, external properties should take lowest priority and should not override any
	 * existing property sources (including local config files). Default false.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> overrideNone <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="nacos内存调优"><a href="#nacos内存调优" class="header-anchor">#</a> Nacos内存调优</h2> <p><a href="https://juejin.cn/post/6979197210915242015" target="_blank" rel="noopener noreferrer">Nacos 内存参数修改调优--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Nacos是基于Spring Boot的项目，关于Nacos的内存调优本质上就是Spring Boot项目的内存调优，根据自己的业务所需，可以适当的进行参数大小的调整，并观察具体情况，根据业务变化进一步调整。</p> <p>如果只是在测试环境或者微服务数量相对比较少时，采用Nacos默认的JVM配置会浪费很多资源。</p> <p>无论是出于生产环境优化所需，还是出于测试环境不浪费资源所需，都需要对默认的JVM进行调整。</p> <p>所使用的内存参数是在启动命令中进行配置的。而启动命令位于startup.sh（或.cmd）当中：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment">#===========================================================================================</span>
<span class="token comment"># JVM Configuration</span>
<span class="token comment">#===========================================================================================</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${MODE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;standalone&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Xms512m -Xmx512m -Xmn256m&quot;</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -Dnacos.standalone=true&quot;</span>
<span class="token keyword">else</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">${EMBEDDED_STORAGE}</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;embedded&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -DembeddedStorage=true&quot;</span>
    <span class="token keyword">fi</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -server -Xms2g -Xmx2g -Xmn1g -XX:MetaspaceSize=128m -XX:MaxMetaspaceSize=320m&quot;</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -XX:-OmitStackTraceInFastThrow -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=<span class="token variable">${BASE_DIR}</span>/logs/java_heapdump.hprof&quot;</span>
    <span class="token assign-left variable">JAVA_OPT</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${JAVA_OPT}</span> -XX:-UseLargePages&quot;</span>

<span class="token keyword">fi</span>
</code></pre></div><p>可以看出，如果是standalone模式启动，默认内存参数为“-Xms512m -Xmx512m -Xmn256m”，虽然不少，但还算可以。</p> <p>但如果是其他模式启动，则内存直接分配2个G，可能根本用不到这么多，这个就有点坑了。</p> <p>其中对应参数的含义：</p> <ul><li>Xms: 设定程序启动时占用内存大小</li> <li>Xmx: 设定程序运行期间最大可占用的内存大小</li> <li>Xmn：新生代大小</li></ul> <p>为了避免频繁GC,设置的最小和最大内存为2G。因此，我们需要根据自己的业务情况，来进行占用内存的修改。</p> <p>如果是基于Docker进行服务启动的，则可以通过环境变量进行调整：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nacos/nacos<span class="token punctuation">-</span>server<span class="token punctuation">:</span>latest                             <span class="token comment"># 镜像`nacos/nacos-server:latest`</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> nacos_server                                 <span class="token comment"># 容器名为'nacos_server'</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always                                              <span class="token comment"># 指定容器退出后的重启策略为始终重启</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>                                                     <span class="token comment"># 数据卷挂载路径设置,将本机目录映射到容器目录</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/opt/nacous/nacos_docker/logs:/home/nacos/logs&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/opt/nacous/nacos_docker/init.d/custom.properties:/home/nacos/init.d/custom.properties&quot;</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>                        <span class="token comment"># 设置环境变量,相当于docker run命令中的-e</span>
      <span class="token punctuation">-</span> PREFER_HOST_MODE=hostname       <span class="token comment"># 是否支持hostname</span>
      <span class="token punctuation">-</span> MODE=standalone                           <span class="token comment"># 单机模式启动</span>
      <span class="token punctuation">-</span> SPRING_DATASOURCE_PLATFORM=mysql
      <span class="token punctuation">-</span> MYSQL_SERVICE_HOST=127.0.0.1    <span class="token comment"># 注：这里不能为`127.0.0.1`或`localhost`方式！！！</span>
      <span class="token punctuation">-</span> MYSQL_SERVICE_DB_NAME=nacos_config        <span class="token comment"># 所需sql脚本位于 `nacos-mysql/nacos-mysql.sql`</span>
      <span class="token punctuation">-</span> MYSQL_SERVICE_PORT=3306
      <span class="token punctuation">-</span> MYSQL_SERVICE_USER=root
      <span class="token punctuation">-</span> MYSQL_SERVICE_PASSWORD=123456
       <span class="token comment"># JVM调优参数</span>
      <span class="token punctuation">-</span> JVM_XMS=64m   <span class="token comment">#-Xms default :2g</span>
      <span class="token punctuation">-</span> JVM_XMX=64m   <span class="token comment">#-Xmx default :2g</span>
      <span class="token punctuation">-</span> JVM_XMN=16m   <span class="token comment">#-Xmn default :1g</span>
      <span class="token punctuation">-</span> JVM_MS=8m     <span class="token comment">#-XX:MetaspaceSize default :128m</span>
      <span class="token punctuation">-</span> JVM_MMS=8m    <span class="token comment">#-XX:MaxMetaspaceSize default :320m</span>
      <span class="token punctuation">-</span> NACOS_DEBUG=n <span class="token comment">#是否开启远程debug，y/n，默认n</span>
      <span class="token punctuation">-</span> TOMCAT_ACCESSLOG_ENABLED=false <span class="token comment">#是否开始tomcat访问日志的记录，默认false</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>                              <span class="token comment"># 映射端口</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8848:8848&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;9555:9555&quot;</span>
    <span class="token comment"># mem_limit: 300m   # 最大使用内存</span>
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://nacos.io/zh-cn/" target="_blank" rel="noopener noreferrer">Nacos--官网--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://github.com/alibaba/spring-cloud-alibaba/wiki/Nacos-config" target="_blank" rel="noopener noreferrer">Nacos--扩展配置/共享配置--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.bilibili.com/video/BV1VJ411X7xX?p=15" target="_blank" rel="noopener noreferrer">Spring Cloud Alibaba Nacos 配置中心与服务发现--黑马程序员--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.cn/post/6979197210915242015" target="_blank" rel="noopener noreferrer">Nacos 内存参数修改调优--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://cloud.tencent.com/developer/article/1083139" target="_blank" rel="noopener noreferrer">Spring Cloud 覆写远端的配置属性--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">14 days ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/it/micro_services/SpringCloudGateway.html" class="prev">
        聚合网关·Gateway
      </a></span> <span class="next"><a href="/it/micro_services/Ribbon.html">
        负载均衡·Ribbon
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9098f2d6.js" defer></script><script src="/assets/js/2.f664f0df.js" defer></script><script src="/assets/js/74.9a692a0b.js" defer></script><script src="/assets/js/4.7d1e3a27.js" defer></script><script src="/assets/js/10.f82cd603.js" defer></script>
  </body>
</html>
