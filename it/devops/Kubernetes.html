<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>归律诗书屋</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="/js/base.js"></script>
    <meta name="description" content="规律是什么，应该做什么">
    
    <link rel="preload" href="/assets/css/0.styles.732cfe5a.css" as="style"><link rel="preload" href="/assets/js/app.9098f2d6.js" as="script"><link rel="preload" href="/assets/js/2.f664f0df.js" as="script"><link rel="preload" href="/assets/js/49.8746a81f.js" as="script"><link rel="preload" href="/assets/js/4.7d1e3a27.js" as="script"><link rel="preload" href="/assets/js/10.f82cd603.js" as="script"><link rel="prefetch" href="/assets/js/100.0b017729.js"><link rel="prefetch" href="/assets/js/101.a32b7951.js"><link rel="prefetch" href="/assets/js/102.bc1b6c72.js"><link rel="prefetch" href="/assets/js/103.9f45dbec.js"><link rel="prefetch" href="/assets/js/104.c4d95740.js"><link rel="prefetch" href="/assets/js/11.f76fc40f.js"><link rel="prefetch" href="/assets/js/12.6944af50.js"><link rel="prefetch" href="/assets/js/13.b89150ac.js"><link rel="prefetch" href="/assets/js/14.1501f817.js"><link rel="prefetch" href="/assets/js/15.4ef0f2a7.js"><link rel="prefetch" href="/assets/js/16.120197c6.js"><link rel="prefetch" href="/assets/js/17.0e60bb83.js"><link rel="prefetch" href="/assets/js/18.2318b5c9.js"><link rel="prefetch" href="/assets/js/19.8bdd7690.js"><link rel="prefetch" href="/assets/js/20.4a833638.js"><link rel="prefetch" href="/assets/js/21.94094807.js"><link rel="prefetch" href="/assets/js/22.43cb76f6.js"><link rel="prefetch" href="/assets/js/23.c4100de5.js"><link rel="prefetch" href="/assets/js/24.13a694fe.js"><link rel="prefetch" href="/assets/js/25.73e7c270.js"><link rel="prefetch" href="/assets/js/26.cec4157b.js"><link rel="prefetch" href="/assets/js/27.3e6f7d78.js"><link rel="prefetch" href="/assets/js/28.50860f22.js"><link rel="prefetch" href="/assets/js/29.dade73f8.js"><link rel="prefetch" href="/assets/js/3.6afeda28.js"><link rel="prefetch" href="/assets/js/30.e415a951.js"><link rel="prefetch" href="/assets/js/31.245e1ff8.js"><link rel="prefetch" href="/assets/js/32.1c58c318.js"><link rel="prefetch" href="/assets/js/33.2a35dc80.js"><link rel="prefetch" href="/assets/js/34.928df80d.js"><link rel="prefetch" href="/assets/js/35.7caf1f6b.js"><link rel="prefetch" href="/assets/js/36.eef51210.js"><link rel="prefetch" href="/assets/js/37.daa3f442.js"><link rel="prefetch" href="/assets/js/38.eeffb529.js"><link rel="prefetch" href="/assets/js/39.95683b9b.js"><link rel="prefetch" href="/assets/js/40.7f72a5a5.js"><link rel="prefetch" href="/assets/js/41.d9074d14.js"><link rel="prefetch" href="/assets/js/42.efdc1f95.js"><link rel="prefetch" href="/assets/js/43.4d868b19.js"><link rel="prefetch" href="/assets/js/44.39f49c28.js"><link rel="prefetch" href="/assets/js/45.fed4a64f.js"><link rel="prefetch" href="/assets/js/46.81f4a3ca.js"><link rel="prefetch" href="/assets/js/47.a3bf6707.js"><link rel="prefetch" href="/assets/js/48.c6d93e94.js"><link rel="prefetch" href="/assets/js/5.2a0c43dc.js"><link rel="prefetch" href="/assets/js/50.7d5ec5b6.js"><link rel="prefetch" href="/assets/js/51.95b7c204.js"><link rel="prefetch" href="/assets/js/52.00a09d16.js"><link rel="prefetch" href="/assets/js/53.9524084e.js"><link rel="prefetch" href="/assets/js/54.1a8cc05a.js"><link rel="prefetch" href="/assets/js/55.71782b73.js"><link rel="prefetch" href="/assets/js/56.b947061b.js"><link rel="prefetch" href="/assets/js/57.11a9393e.js"><link rel="prefetch" href="/assets/js/58.c8fbf621.js"><link rel="prefetch" href="/assets/js/59.625314bf.js"><link rel="prefetch" href="/assets/js/6.c059e3e4.js"><link rel="prefetch" href="/assets/js/60.1ec17786.js"><link rel="prefetch" href="/assets/js/61.d4981987.js"><link rel="prefetch" href="/assets/js/62.d9540377.js"><link rel="prefetch" href="/assets/js/63.7ce35e41.js"><link rel="prefetch" href="/assets/js/64.48918d7f.js"><link rel="prefetch" href="/assets/js/65.407e96f4.js"><link rel="prefetch" href="/assets/js/66.6997bec9.js"><link rel="prefetch" href="/assets/js/67.c5e5f86c.js"><link rel="prefetch" href="/assets/js/68.ee64232e.js"><link rel="prefetch" href="/assets/js/69.dc92dff3.js"><link rel="prefetch" href="/assets/js/7.cf1c6bc8.js"><link rel="prefetch" href="/assets/js/70.7e22b5d4.js"><link rel="prefetch" href="/assets/js/71.15065321.js"><link rel="prefetch" href="/assets/js/72.3386bac8.js"><link rel="prefetch" href="/assets/js/73.fb724b18.js"><link rel="prefetch" href="/assets/js/74.9a692a0b.js"><link rel="prefetch" href="/assets/js/75.202da1fd.js"><link rel="prefetch" href="/assets/js/76.70c1c8f8.js"><link rel="prefetch" href="/assets/js/77.70291f3f.js"><link rel="prefetch" href="/assets/js/78.b7cd50b7.js"><link rel="prefetch" href="/assets/js/79.3d7eb8e2.js"><link rel="prefetch" href="/assets/js/8.ff8ef414.js"><link rel="prefetch" href="/assets/js/80.ce8dffd6.js"><link rel="prefetch" href="/assets/js/81.c34c3904.js"><link rel="prefetch" href="/assets/js/82.9414052b.js"><link rel="prefetch" href="/assets/js/83.a2da1a0a.js"><link rel="prefetch" href="/assets/js/84.589d3fe4.js"><link rel="prefetch" href="/assets/js/85.40a5ab61.js"><link rel="prefetch" href="/assets/js/86.03d4caec.js"><link rel="prefetch" href="/assets/js/87.5bfbb8de.js"><link rel="prefetch" href="/assets/js/88.d63f9a15.js"><link rel="prefetch" href="/assets/js/89.31f30592.js"><link rel="prefetch" href="/assets/js/9.46c773a8.js"><link rel="prefetch" href="/assets/js/90.82e6bbde.js"><link rel="prefetch" href="/assets/js/91.e6ef02dd.js"><link rel="prefetch" href="/assets/js/92.485a3afc.js"><link rel="prefetch" href="/assets/js/93.80da4442.js"><link rel="prefetch" href="/assets/js/94.69591e93.js"><link rel="prefetch" href="/assets/js/95.b233d915.js"><link rel="prefetch" href="/assets/js/96.8205937d.js"><link rel="prefetch" href="/assets/js/97.420c1537.js"><link rel="prefetch" href="/assets/js/98.41c37eae.js"><link rel="prefetch" href="/assets/js/99.51e246dc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.732cfe5a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="归律诗书屋" class="logo"> <span class="site-name can-hide">归律诗书屋</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/it/" class="nav-link router-link-active">
  编程
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  万卷书
</a></div><div class="nav-item"><a href="/poetry/" class="nav-link">
  格律诗
</a></div><div class="nav-item"><a href="/meitu/" class="nav-link">
  美图
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用" class="dropdown-title"><span class="title">常用</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用" class="mobile-dropdown-title"><span class="title">常用</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cn.bing.com/?mkt=zh-CN&amp;mkt=zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  必应
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://translate.google.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://stock.tuchong.com/topic?topicId=50044&amp;from=Adobe%E7%8B%AC%E5%AE%B6" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图虫
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.zhouzhiyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  周志远
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baiyunju.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  白云居
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人" class="dropdown-title"><span class="title">个人</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人" class="mobile-dropdown-title"><span class="title">个人</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/misc/2022.html" class="nav-link">
  思记
</a></li><li class="dropdown-item"><!----> <a href="/misc/口语表达.html" class="nav-link">
  口语表达
</a></li><li class="dropdown-item"><!----> <a href="/life/UnusualThinking.html" class="nav-link">
  二般思维
</a></li><li class="dropdown-item"><!----> <a href="/misc/AboutMe.html" class="nav-link">
  狼与羊
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/it/" class="nav-link router-link-active">
  编程
</a></div><div class="nav-item"><a href="/book/" class="nav-link">
  万卷书
</a></div><div class="nav-item"><a href="/poetry/" class="nav-link">
  格律诗
</a></div><div class="nav-item"><a href="/meitu/" class="nav-link">
  美图
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用" class="dropdown-title"><span class="title">常用</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用" class="mobile-dropdown-title"><span class="title">常用</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://cn.bing.com/?mkt=zh-CN&amp;mkt=zh-CN" target="_blank" rel="noopener noreferrer" class="nav-link external">
  必应
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://translate.google.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Google翻译
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://stock.tuchong.com/topic?topicId=50044&amp;from=Adobe%E7%8B%AC%E5%AE%B6" target="_blank" rel="noopener noreferrer" class="nav-link external">
  图虫
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="http://www.zhouzhiyuan.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  周志远
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://baiyunju.cc/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  白云居
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="个人" class="dropdown-title"><span class="title">个人</span> <span class="arrow down"></span></button> <button type="button" aria-label="个人" class="mobile-dropdown-title"><span class="title">个人</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/misc/2022.html" class="nav-link">
  思记
</a></li><li class="dropdown-item"><!----> <a href="/misc/口语表达.html" class="nav-link">
  口语表达
</a></li><li class="dropdown-item"><!----> <a href="/life/UnusualThinking.html" class="nav-link">
  二般思维
</a></li><li class="dropdown-item"><!----> <a href="/misc/AboutMe.html" class="nav-link">
  狼与羊
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>不只是编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>中间件</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微服务</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>DevOps</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/it/devops/Maven.html" class="sidebar-link">Maven</a></li><li><a href="/it/devops/Git.html" class="sidebar-link">Git</a></li><li><a href="/it/devops/Nginx.html" class="sidebar-link">Nginx</a></li><li><a href="/it/devops/Windows.html" class="sidebar-link">Windows</a></li><li><a href="/it/devops/Linux.html" class="sidebar-link">Linux</a></li><li><a href="/it/devops/Linux-CentOS.html" class="sidebar-link">Linux-CentOS</a></li><li><a href="/it/devops/Linux-Ubuntu.html" class="sidebar-link">Linux-Ubuntu</a></li><li><a href="/it/devops/Docker.html" class="sidebar-link">Docker</a></li><li><a href="/it/devops/Kubernetes.html" aria-current="page" class="active sidebar-link">Kubernetes</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#简介" class="sidebar-link">简介</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#架构" class="sidebar-link">架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#master" class="sidebar-link">Master</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#node" class="sidebar-link">Node</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#核心概念" class="sidebar-link">核心概念</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#安装准备" class="sidebar-link">安装准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#网络配置" class="sidebar-link">网络配置</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#关闭防火墙" class="sidebar-link">关闭防火墙</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#关闭交换空间" class="sidebar-link">关闭交换空间</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#校对时间" class="sidebar-link">校对时间</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#修改主机名称" class="sidebar-link">修改主机名称</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#本地域名解析" class="sidebar-link">本地域名解析</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#将桥接的ipv4流量传递到iptables的链" class="sidebar-link">将桥接的IPv4流量传递到iptables的链</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#安装docker-镜像加速" class="sidebar-link">安装Docker/镜像加速</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#kubernetes组网" class="sidebar-link">Kubernetes组网</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#安装kubeadm-kubectl-kubelet" class="sidebar-link">安装kubeadm/kubectl/kubelet</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#初始化master" class="sidebar-link">初始化Master</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#添加从节点" class="sidebar-link">添加从节点</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#重置" class="sidebar-link">重置</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#网络" class="sidebar-link">网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#容器网络" class="sidebar-link">容器网络</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#kubernetes网络模型" class="sidebar-link">Kubernetes网络模型</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#安装calico" class="sidebar-link">安装Calico</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#nfs数据卷" class="sidebar-link">NFS数据卷</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#nfs服务器" class="sidebar-link">NFS服务器</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#问题" class="sidebar-link">问题</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#数据卷-定义-声明-使用" class="sidebar-link">数据卷（定义/声明/使用）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#交互流程" class="sidebar-link">交互流程</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#pv示例" class="sidebar-link">PV示例</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#pvc示例" class="sidebar-link">PVC示例</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#常用服务列表" class="sidebar-link">常用服务列表</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#yaml文件的自动生成" class="sidebar-link">yaml文件的自动生成</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#kuboard" class="sidebar-link">Kuboard</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#nginx" class="sidebar-link">Nginx</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#rabbitmq" class="sidebar-link">RabbitMQ</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#nacos" class="sidebar-link">Nacos</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#常见问题" class="sidebar-link">常见问题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#修改默认端口范围" class="sidebar-link">修改默认端口范围</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#常用命令" class="sidebar-link">常用命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#帮助命令" class="sidebar-link">帮助命令</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#查看版本" class="sidebar-link">查看版本</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#打印join-token" class="sidebar-link">打印join token</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#所有命名空间" class="sidebar-link">所有命名空间</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#配置imagepullsecret" class="sidebar-link">配置imagePullSecret</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#指定版本的kubelet-kubeadm-kubectl" class="sidebar-link">指定版本的kubelet/kubeadm/kubectl</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#查看集群信息" class="sidebar-link">查看集群信息</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#查看资源实体" class="sidebar-link">查看资源实体</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#显示更多信息" class="sidebar-link">显示更多信息</a></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#确定-apiversion" class="sidebar-link">确定 apiVersion</a></li></ul></li><li class="sidebar-sub-header"><a href="/it/devops/Kubernetes.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/it/devops/Jenkins.html" class="sidebar-link">Jenkins</a></li><li><a href="/it/devops/DingRobot.html" class="sidebar-link">钉钉机器人</a></li><li><a href="/it/devops/内网穿透.html" class="sidebar-link">内网穿透</a></li><li><a href="https://chenpipi.cn/post/yaml-all-in-one/" target="_blank" rel="noopener noreferrer" class="sidebar-link">YAML<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/it/devops/XaaS.html" class="sidebar-link">XaaS</a></li><li><a href="/it/devops/Port.html" class="sidebar-link">端口</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>前端</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Android</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>领域模型</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具箱</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="https://pangniao.net/page/7/" target="_blank" rel="noopener noreferrer" class="sidebar-link">胖鸟<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="/it/tool/科学上网.html" class="sidebar-link">科学上网</a></li><li><a href="https://www.youhou8.com/users/max/scripts" target="_blank" rel="noopener noreferrer" class="sidebar-link">油猴<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li><a href="https://www.liantu.com/?123=http://qcsd-web-dev.oss-cn-qingdao.aliyuncs.com/" target="_blank" rel="noopener noreferrer" class="sidebar-link">二维码生成<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/devops/kubernetes-cover.png" data-v-2a6bf9e1> <h2 id="简介"><a href="#简介" class="header-anchor">#</a> 简介</h2> <p>Kubernetes是一个容器编排工具，提高应用的容器化部署及维护的效率。</p> <p>Kubernetes一个核心的特点就是能够自主的管理容器，让其按照用户的期望状态运行着。</p> <p>Kubernetes比docker-compose更加方便，docker-compose常用于单机环境下的容器编排，而Kubernetes适合在集群环境下进行容器编排。</p> <p>Kubernetes的前身是Google的Brog系统，高效方便地管理着分布式系统的各种资源，如计算资源、存储资源、网络资源等。</p> <p>其有如下特性：</p> <ul><li>持续开发、集成和部署</li> <li>可自动扩展的基础架构</li> <li>开发、测试、生产环境的一致性</li> <li>更高的资源利用效率</li></ul> <h2 id="架构"><a href="#架构" class="header-anchor">#</a> 架构</h2> <p>Kubernetes遵循客户端-服务器架构（BS），master和node安装在不同的Linux机器上。</p> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/devops/kubernetes_architecture1.jpg"></div> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/devops/kubernetes_architecture2.jpg"></div> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/devops/kubernetes_architecture3.png"></div> <h3 id="master"><a href="#master" class="header-anchor">#</a> Master</h3> <ul><li>api server：对外暴露Kubernetes的API，接收客户端的请求（kubectl客户端、Web可视化客户端）</li> <li>controller：该组件是一个守护进程，负责管理Cluster各种资源。
<ul><li>由多种controller组成，不同的controller管理不同的资源。如replication controller管理deployment，namespace controller管理Namespace资源。</li> <li>负责维持副本的期望数目</li></ul></li> <li>scheduler：负责分配工作负载，基于用户的期望状态和集群的实时状态，选择合适的节点进行任务分配</li> <li>etcd：是一个高可用的分布式键值存储数据库，负责存储k8s集群所有需要持久化的重要信息，协助分布式集群的正常运转。</li></ul> <h3 id="node"><a href="#node" class="header-anchor">#</a> Node</h3> <ul><li>kubelet：负责与master节点进行通信，上报当前节点的信息，接收master的指令，对pod、volumes、container（docker）进行管理。</li> <li>kube proxy：提供网络方面的路由与转发，以实现服务的映射访问和负载均衡。</li> <li>Container Runtime（Docker）：具体的容器引擎，提供在相对隔离但轻量级的环境中运行应用程序的能力。</li></ul> <h2 id="核心概念"><a href="#核心概念" class="header-anchor">#</a> 核心概念</h2> <ul><li>Cluster：是计算、存储和网络资源的集合，Kubeneters利用这些资源运行各种基于容器的应用。</li> <li>Master：是Cluster的大脑，它的主要职责是调度即决定将应用放在哪里运行。为了实现高可用，可以运行多个Master</li> <li>Node：职责是运行容器应用。Node由Master管理，Node负责监控并汇报容器的状态，同时根据Master的要求管理容器的生命周期</li> <li>Pod：是Kubernetes的最小工作单元。每个Pod包含一个或多个容器。Pod中的容器会作为一个整体被Master调度到一个Node上运行。Kubernetes引入Pod的目的如下：
<ul><li>可管理性：有些容器天生就是需要紧密联系，一起工作。因此Pod提供了比容器更高层次的抽象。以Pod为最小单位进行调度、扩展、共享资源、管理生命周期。</li> <li>通信和资源共享：pod中的所有容器使用同一个namespace，即相同的IP地址和Port空间。</li></ul></li> <li>Controller：Kubernetes通常不会直接创建Pod，而是通过Controller来管理Pod。
<ul><li>Controller中定义了Pod的部署特性，比如有几个副本、在什么样的Node上运行等。</li> <li>为了满足不同的业务场景，Kubernetes提供了多种Controller
<ul><li>Deployment：是最常用的Controller，可管理Pod的多个副本，且确保Pod按照期望的状态运行</li> <li>ReplicaSet：实现了多副本的管理。通常不需要直接使用ReplicaSet</li> <li>DaemonSet：用于每个Node最多只运行一个Pod副本的场景。Daemon通常用于运行daemon。</li> <li>StatefuleSet：保证pod的每个副本在整个生命周期中名称是不变的，而其他Controller不提供这个功能。</li> <li>Job：用于运行结束就删除的应用。其他的Controller中的Pod通常是长期持续运行。</li></ul></li></ul></li> <li>Service：
<ul><li>每个Pod都有自己的ip，且pod很可能会被频繁地销毁和重启，ip会发生变化。</li> <li>Kubernetes service定义了外界访问一组特定pod的方式。service有自己的ip和端口，Service为pod提供了负载均衡</li></ul></li> <li><strong>Kubernetes运行容器（Pod）和访问容器（Pod）这两项任务分别由Controller和Service执行</strong>。</li> <li>Namespace：
<ul><li>多个用户或项目组使用同一个Kubernetes Cluster，用于将其创建的Controller和Pod等资源分开</li> <li>不同Namespace里的资源是完全隔离的</li> <li>Kubernetes默认创建了两个Namespace
<ul><li>default：创建资源如果不指定，将被放到该命名空间下</li> <li>kube-system：Kubernetes自己创建的系统资源将放到这个Namespace中。</li></ul></li></ul></li></ul> <h2 id="安装准备"><a href="#安装准备" class="header-anchor">#</a> 安装准备</h2> <h3 id="网络配置"><a href="#网络配置" class="header-anchor">#</a> 网络配置</h3> <p><a href="/it/devops/Linux-CentOS.html#网络配置">传送门</a></p> <h3 id="关闭防火墙"><a href="#关闭防火墙" class="header-anchor">#</a> 关闭防火墙</h3> <p><a href="/it/devops/Linux-CentOS.html#关闭防火墙">传送门</a></p> <h3 id="关闭交换空间"><a href="#关闭交换空间" class="header-anchor">#</a> 关闭交换空间</h3> <p><a href="/it/devops/Linux-CentOS.html#关闭交换空间">CentOS传送门</a></p> <h3 id="校对时间"><a href="#校对时间" class="header-anchor">#</a> 校对时间</h3> <p><a href="/it/devops/Linux-CentOS.html#校对时间">CentOS传送门</a></p> <h3 id="修改主机名称"><a href="#修改主机名称" class="header-anchor">#</a> 修改主机名称</h3> <p><a href="/it/devops/Linux.html#修改主机名称">传送门</a></p> <h3 id="本地域名解析"><a href="#本地域名解析" class="header-anchor">#</a> 本地域名解析</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># vim /etc/hosts 建议配置一下 host 这里写你的ip </span>
<span class="token number">192.168</span>.3.110 kubernetes-master 
<span class="token number">192.168</span>.3.120 kubernetes-node1 
<span class="token number">192.168</span>.3.121 kubernetes-node2
</code></pre></div><h3 id="将桥接的ipv4流量传递到iptables的链"><a href="#将桥接的ipv4流量传递到iptables的链" class="header-anchor">#</a> 将桥接的IPv4流量传递到iptables的链</h3> <p>有一些ipv4的流量不能走iptables链（linux内核的一个过滤器，每个流量都会经过他，然后再匹配是否可进入当前应用进程去处理），导致流量丢失。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 配置k8s.conf文件（#k8s.conf文件原来不存在，需要自己创建的）</span>
<span class="token comment"># 或者直接vi /etc/sysctl.d/k8s.conf   最后添加如下3行</span>
net.bridge.bridge-nf-call-ip6tables<span class="token operator">=</span><span class="token number">1</span>
net.bridge.bridge-nf-call-iptables<span class="token operator">=</span><span class="token number">1</span>
vm.swappiness<span class="token operator">=</span><span class="token number">0</span>
<span class="token comment"># 添加完毕后执行 sysctl --system 生效</span>
</code></pre></div><h3 id="安装docker-镜像加速"><a href="#安装docker-镜像加速" class="header-anchor">#</a> 安装Docker/镜像加速</h3> <p><a href="/it/devops/Docker.html#安装">传送门</a></p> <h2 id="kubernetes组网"><a href="#kubernetes组网" class="header-anchor">#</a> Kubernetes组网</h2> <h3 id="安装kubeadm-kubectl-kubelet"><a href="#安装kubeadm-kubectl-kubelet" class="header-anchor">#</a> 安装kubeadm/kubectl/kubelet</h3> <p>Master/Node节点都需要安装。</p> <p><a href="https://developer.aliyun.com/mirror/kubernetes" target="_blank" rel="noopener noreferrer">阿里云镜像--传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="debian-ubuntu"><a href="#debian-ubuntu" class="header-anchor">#</a> Debian/Ubuntu</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y apt-transport-https
<span class="token function">curl</span> https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg <span class="token operator">|</span> apt-key <span class="token function">add</span> - 
<span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span>/etc/apt/sources.list.d/kubernetes.list</span>
deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main
EOF</span>
<span class="token function">apt-get</span> update
<span class="token function">apt-get</span> <span class="token function">install</span> -y kubelet kubeadm kubectl
</code></pre></div><h4 id="centos-rhel-fedora"><a href="#centos-rhel-fedora" class="header-anchor">#</a> CentOS/RHEL/Fedora</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/yum.repos.d/kubernetes.repo</span>
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>
setenforce <span class="token number">0</span>
yum <span class="token function">install</span> -y kubelet kubeadm kubectl
systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token operator">&amp;&amp;</span> systemctl start kubelet
</code></pre></div><p>ps: 由于官网未开放同步方式, 可能会有索引gpg检查失败的情况, 这时请用 <code>yum install -y --nogpgcheck kubelet kubeadm kubectl</code> 安装</p> <h3 id="初始化master"><a href="#初始化master" class="header-anchor">#</a> 初始化Master</h3> <h4 id="目录准备"><a href="#目录准备" class="header-anchor">#</a> 目录准备</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /usr/local
<span class="token comment">#创建目录</span>
<span class="token function">mkdir</span> -p kubernetes/cluster
<span class="token comment"># 进入目录</span>
<span class="token builtin class-name">cd</span> /kubernetes/cluster
</code></pre></div><h4 id="yml文件"><a href="#yml文件" class="header-anchor">#</a> yml文件</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 在 /usr/local/kubernetes/cluster 路径下执行</span>
kubeadm config print init-defaults --kubeconfig ClusterConfiguration <span class="token operator">&gt;</span> kubeadm.yml
</code></pre></div><ul><li>修改主节点名称 localAPIEndpoint.advertiseAddress</li> <li>修改仓库地址 imageRepository</li> <li>修改版本号 kubernetesVersion</li> <li>增加pod的网段 podSubnet: &quot;10.244.0.0/16&quot;</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">bootstrapTokens</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">groups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> system<span class="token punctuation">:</span>bootstrappers<span class="token punctuation">:</span>kubeadm<span class="token punctuation">:</span>default<span class="token punctuation">-</span>node<span class="token punctuation">-</span>token
    <span class="token key atrule">token</span><span class="token punctuation">:</span> abcdef.0123456789abcdef
    <span class="token key atrule">ttl</span><span class="token punctuation">:</span> 24h0m0s
    <span class="token key atrule">usages</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> signing
      <span class="token punctuation">-</span> authentication
<span class="token key atrule">kind</span><span class="token punctuation">:</span> InitConfiguration
<span class="token key atrule">localAPIEndpoint</span><span class="token punctuation">:</span>
  <span class="token comment"># 修改为主节点 IP</span>
  <span class="token key atrule">advertiseAddress</span><span class="token punctuation">:</span> 192.168.3.110
  <span class="token key atrule">bindPort</span><span class="token punctuation">:</span> <span class="token number">6443</span>
<span class="token key atrule">nodeRegistration</span><span class="token punctuation">:</span>
  <span class="token key atrule">criSocket</span><span class="token punctuation">:</span> /var/run/dockershim.sock
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>master
  <span class="token key atrule">taints</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
<span class="token punctuation">---</span>
<span class="token key atrule">apiServer</span><span class="token punctuation">:</span>
  <span class="token key atrule">timeoutForControlPlane</span><span class="token punctuation">:</span> 4m0s
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> kubeadm.k8s.io/v1beta2
<span class="token key atrule">certificatesDir</span><span class="token punctuation">:</span> /etc/kubernetes/pki
<span class="token key atrule">clusterName</span><span class="token punctuation">:</span> kubernetes
<span class="token key atrule">controllerManager</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token key atrule">dns</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> CoreDNS
<span class="token key atrule">etcd</span><span class="token punctuation">:</span>
  <span class="token key atrule">local</span><span class="token punctuation">:</span>
    <span class="token key atrule">dataDir</span><span class="token punctuation">:</span> /var/lib/etcd
<span class="token comment"># 国内不能访问 Google，修改为阿里云</span>
<span class="token key atrule">imageRepository</span><span class="token punctuation">:</span> registry.aliyuncs.com/google_containers
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterConfiguration
<span class="token comment"># 这里要对应的安装的adm 版本号</span>
<span class="token key atrule">kubernetesVersion</span><span class="token punctuation">:</span> v1.18.2
<span class="token key atrule">networking</span><span class="token punctuation">:</span>
  <span class="token key atrule">dnsDomain</span><span class="token punctuation">:</span> cluster.local
  <span class="token comment"># 配置 POD 所在网段为我们虚拟机不重叠的网段（这里用的是 Flannel 默认网段）</span>
  <span class="token key atrule">podSubnet</span><span class="token punctuation">:</span> <span class="token string">&quot;10.244.0.0/16&quot;</span>
  <span class="token key atrule">serviceSubnet</span><span class="token punctuation">:</span> 10.96.0.0/12
<span class="token key atrule">scheduler</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><h4 id="查看所需镜像"><a href="#查看所需镜像" class="header-anchor">#</a> 查看所需镜像</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm config images list --config kubeadm.yml

<span class="token comment"># registry.aliyuncs.com/google_containers/kube-apiserver:v1.18.2</span>
<span class="token comment"># registry.aliyuncs.com/google_containers/kube-controller-manager:v1.18.2</span>
<span class="token comment"># registry.aliyuncs.com/google_containers/kube-scheduler:v1.18.2</span>
<span class="token comment"># registry.aliyuncs.com/google_containers/kube-proxy:v1.18.2</span>
<span class="token comment"># registry.aliyuncs.com/google_containers/pause:3.2</span>
<span class="token comment"># registry.aliyuncs.com/google_containers/etcd:3.4.3-0</span>
<span class="token comment"># registry.aliyuncs.com/google_containers/coredns:1.6.7</span>
</code></pre></div><h4 id="拉取所需镜像"><a href="#拉取所需镜像" class="header-anchor">#</a> 拉取所需镜像</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm config images pull --config kubeadm.yml

<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/kube-apiserver:v1.18.2</span>
<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/kube-controller-manager:v1.18.2</span>
<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/kube-scheduler:v1.18.2</span>
<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/kube-proxy:v1.18.2</span>
<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/pause:3.2</span>
<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/etcd:3.4.3-0</span>
<span class="token comment"># [config/images] Pulled registry.aliyuncs.com/google_containers/coredns:1.6.7</span>
</code></pre></div><h4 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h4> <p>执行以下命令初始化主节点，该命令指定了初始化时需要使用的配置文件，
其中添加 <code>--upload-certs</code> 参数可以在后续执行加入节点时自动分发证书文件。追加的 <code>tee kubeadm-init.log</code> 用以输出日志。</p> <p>如果安装 kubernetes 版本和下载的镜像版本不统一则会出现 <code>timed out waiting for the condition</code> 错误。
中途失败或是想修改配置可以使用<code>kubeadm reset</code>命令进行重置，再做初始化操作即可。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm init --config<span class="token operator">=</span>kubeadm.yml --upload-certs <span class="token operator">|</span> <span class="token function">tee</span> kubeadm-init.log

<span class="token punctuation">[</span>init<span class="token punctuation">]</span> Using Kubernetes version: v1.18.2
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Running pre-flight checks
	<span class="token punctuation">[</span>WARNING IsDockerSystemdCheck<span class="token punctuation">]</span>: detected <span class="token string">&quot;cgroupfs&quot;</span> as the Docker cgroup driver. The recommended driver is <span class="token string">&quot;systemd&quot;</span><span class="token builtin class-name">.</span> Please follow the guide at https://kubernetes.io/docs/setup/cri/
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> Pulling images required <span class="token keyword">for</span> setting up a Kubernetes cluster
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> This might take a minute or two, depending on the speed of your internet connection
<span class="token punctuation">[</span>preflight<span class="token punctuation">]</span> You can also perform this action <span class="token keyword">in</span> beforehand using <span class="token string">'kubeadm config images pull'</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet environment <span class="token function">file</span> with flags to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Writing kubelet configuration to <span class="token function">file</span> <span class="token string">&quot;/var/lib/kubelet/config.yaml&quot;</span>
<span class="token punctuation">[</span>kubelet-start<span class="token punctuation">]</span> Starting the kubelet
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Using certificateDir folder <span class="token string">&quot;/etc/kubernetes/pki&quot;</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;ca&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;apiserver&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> apiserver serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>kubernetes-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">10.96</span>.0.1 <span class="token number">192.168</span>.3.110<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;apiserver-kubelet-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;front-proxy-ca&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;front-proxy-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/ca&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/server&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/server serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>kubernetes-master localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">192.168</span>.3.110 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/peer&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> etcd/peer serving cert is signed <span class="token keyword">for</span> DNS names <span class="token punctuation">[</span>kubernetes-master localhost<span class="token punctuation">]</span> and IPs <span class="token punctuation">[</span><span class="token number">192.168</span>.3.110 <span class="token number">127.0</span>.0.1 ::1<span class="token punctuation">]</span>
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;etcd/healthcheck-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;apiserver-etcd-client&quot;</span> certificate and key
<span class="token punctuation">[</span>certs<span class="token punctuation">]</span> Generating <span class="token string">&quot;sa&quot;</span> key and public key
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Using kubeconfig folder <span class="token string">&quot;/etc/kubernetes&quot;</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;admin.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;kubelet.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;controller-manager.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>kubeconfig<span class="token punctuation">]</span> Writing <span class="token string">&quot;scheduler.conf&quot;</span> kubeconfig <span class="token function">file</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Using manifest folder <span class="token string">&quot;/etc/kubernetes/manifests&quot;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">&quot;kube-apiserver&quot;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">&quot;kube-controller-manager&quot;</span>
W0430 <span class="token number">17</span>:04:10.931026    <span class="token number">3627</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token string">&quot;Node,RBAC&quot;</span><span class="token punctuation">;</span> using <span class="token string">&quot;Node,RBAC&quot;</span>
W0430 <span class="token number">17</span>:04:10.931702    <span class="token number">3627</span> manifests.go:225<span class="token punctuation">]</span> the default kube-apiserver authorization-mode is <span class="token string">&quot;Node,RBAC&quot;</span><span class="token punctuation">;</span> using <span class="token string">&quot;Node,RBAC&quot;</span>
<span class="token punctuation">[</span>control-plane<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token string">&quot;kube-scheduler&quot;</span>
<span class="token punctuation">[</span>etcd<span class="token punctuation">]</span> Creating static Pod manifest <span class="token keyword">for</span> <span class="token builtin class-name">local</span> etcd <span class="token keyword">in</span> <span class="token string">&quot;/etc/kubernetes/manifests&quot;</span>
<span class="token punctuation">[</span>wait-control-plane<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> the kubelet to boot up the control plane as static Pods from directory <span class="token string">&quot;/etc/kubernetes/manifests&quot;</span><span class="token builtin class-name">.</span> This can take up to 4m0s
<span class="token punctuation">[</span>apiclient<span class="token punctuation">]</span> All control plane components are healthy after <span class="token number">21.506907</span> seconds
<span class="token punctuation">[</span>upload-config<span class="token punctuation">]</span> Storing the configuration used <span class="token keyword">in</span> ConfigMap <span class="token string">&quot;kubeadm-config&quot;</span> <span class="token keyword">in</span> the <span class="token string">&quot;kube-system&quot;</span> Namespace
<span class="token punctuation">[</span>kubelet<span class="token punctuation">]</span> Creating a ConfigMap <span class="token string">&quot;kubelet-config-1.18&quot;</span> <span class="token keyword">in</span> namespace kube-system with the configuration <span class="token keyword">for</span> the kubelets <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>upload-certs<span class="token punctuation">]</span> Storing the certificates <span class="token keyword">in</span> Secret <span class="token string">&quot;kubeadm-certs&quot;</span> <span class="token keyword">in</span> the <span class="token string">&quot;kube-system&quot;</span> Namespace
<span class="token punctuation">[</span>upload-certs<span class="token punctuation">]</span> Using certificate key:
d9f7da0494b05cb09b3a27f15bebc389281ade22d90cd17ecdb38a7d3c6fb4be
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the <span class="token function">node</span> kubernetes-master as control-plane by adding the label <span class="token string">&quot;node-role.kubernetes.io/master=''&quot;</span>
<span class="token punctuation">[</span>mark-control-plane<span class="token punctuation">]</span> Marking the <span class="token function">node</span> kubernetes-master as control-plane by adding the taints <span class="token punctuation">[</span>node-role.kubernetes.io/master:NoSchedule<span class="token punctuation">]</span>
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Using token: abcdef.0123456789abcdef
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to get nodes
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow Node Bootstrap tokens to post CSRs <span class="token keyword">in</span> order <span class="token keyword">for</span> nodes to get long term certificate credentials
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> configured RBAC rules to allow certificate rotation <span class="token keyword">for</span> all <span class="token function">node</span> client certificates <span class="token keyword">in</span> the cluster
<span class="token punctuation">[</span>bootstrap-token<span class="token punctuation">]</span> Creating the <span class="token string">&quot;cluster-info&quot;</span> ConfigMap <span class="token keyword">in</span> the <span class="token string">&quot;kube-public&quot;</span> namespace
<span class="token punctuation">[</span>kubelet-finalize<span class="token punctuation">]</span> Updating <span class="token string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: CoreDNS
<span class="token punctuation">[</span>addons<span class="token punctuation">]</span> Applied essential addon: kube-proxy

Your Kubernetes control-plane has initialized successfully<span class="token operator">!</span>

To start using your cluster, you need to run the following as a regular user:

  <span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config

You should now deploy a pod network to the cluster.
Run <span class="token string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:
  https://kubernetes.io/docs/concepts/cluster-administration/addons/

Then you can <span class="token function">join</span> any number of worker nodes by running the following on each as root:

kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.3.110:6443 --token abcdef.0123456789abcdef <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:0c96e0d5df660013c8ebd726c4f7ea022cf205616d4ff30062ed4c43cbd56b81
</code></pre></div><h4 id="配置kubectl"><a href="#配置kubectl" class="header-anchor">#</a> 配置kubectl</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> -p <span class="token environment constant">$HOME</span>/.kube
<span class="token function">cp</span> -i /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config

<span class="token comment"># 非 ROOT 用户执行</span>
<span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -u<span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> -g<span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre></div><h4 id="验证"><a href="#验证" class="header-anchor">#</a> 验证</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get <span class="token function">node</span>

<span class="token comment"># 输出如下</span>
<span class="token punctuation">[</span>root@kubernetes-master cluster<span class="token punctuation">]</span><span class="token comment"># kubectl get node</span>
NAME                STATUS     ROLES    AGE     VERSION
kubernetes-master   NotReady   master   6m34s   v1.18.2
</code></pre></div><h3 id="添加从节点"><a href="#添加从节点" class="header-anchor">#</a> 添加从节点</h3> <p>将 Node 节点加入到集群中很简单，只需要在 Node 服务器上安装 kubeadm，kubectl，kubelet 三个工具，然后使用 <code>kubeadm join</code> 命令加入即可。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.3.110:6443 --token abcdef.0123456789abcdef <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:e4f3d4e6f0154005e6004866fbbf32b09e746cf1a66c9c97de81d1c252ac9b61 
</code></pre></div><p>如果没有上述命令（token），可以通过下面的命令从主节点获取token</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm token create --print-join-command
</code></pre></div><p>执行完毕之后 到 master 节点 执行 <code>kubectl get node</code> 验证是否加入成功。</p> <h3 id="重置"><a href="#重置" class="header-anchor">#</a> 重置</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 重置 'kubeadm init' 或 'kubeadm join' 对此主机所做的更改将被还原 </span>
kubeadm reset
</code></pre></div><h2 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h2> <h3 id="容器网络"><a href="#容器网络" class="header-anchor">#</a> 容器网络</h3> <p>容器网络是容器选择连接到其他容器、主机和外部网络的机制。</p> <p>容器的 runtime 提供了各种网络模式，每种模式都会产生不同的体验。例如，Docker 默认情况下可以为容器配置以下网络：</p> <ol><li>none： 将容器添加到一个容器专门的网络堆栈中，没有对外连接。</li> <li>host： 将容器添加到主机的网络堆栈中，没有隔离。</li> <li>default bridge： 默认网络模式。每个容器可以通过 IP 地址相互连接。</li> <li>自定义网桥： 用户定义的网桥，具有更多的灵活性、隔离性和其他便利功能。</li></ol> <h3 id="kubernetes网络模型"><a href="#kubernetes网络模型" class="header-anchor">#</a> Kubernetes网络模型</h3> <p>Kubernetes采用的是基于扁平地址空间的网络模型。</p> <p>集群中的每隔Pod都有自己的IP地址：</p> <ol><li>【Pod内】同一个Pod中的容器共享Pod的IP，能够通过localhost通信。</li> <li>【Pod间】Pod的IP是集群可见的，Pod之间不需要配置NAT就能直接通过IP进行通信。</li> <li>【基于名称】Service提供了对Pod的抽象层，通过基于名称的访问，屏蔽了Pod由于创建/销毁导致的IP改变带来的问题。</li> <li>【集群外】通过Service的NodePort进行端口映射，对外提供服务。</li></ol> <p>Kubernetes的三层网络模型如下，其中Pod网络和Service都是虚拟网络。</p> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/devops/kubernetes_network.png"></div> <p>CNI(Container Networking Interface)是由CoreOS剔除的容器网络规范，为了保证网络方案的标准化、扩展性和灵活性，使用了插件（Plugin）模型创建容器的网络栈。</p> <p>Kubernetes 中可选的 CNI 插件有Calico（支持Network Policy）、Canal（支持Network Policy）、Flannel（不支持Network Policy）等。</p> <p>所谓Network Policy是基于Label选择Pod，为Pod定义Network Policy后，Pod之间基于特定策略进行隔离，只有Policy允许的流量才能访问Pod。</p> <h3 id="安装calico"><a href="#安装calico" class="header-anchor">#</a> 安装Calico</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 在/usr/local/kubernetes/calico目录下</span>

<span class="token comment"># 下载资源</span>
<span class="token function">wget</span> https://docs.projectcalico.org/manifests/calico.yaml
<span class="token comment"># 注意观察：CALICO_IPV4POOL_CIDR  参数 如果 没有被注释 则需要修改成你分配个pod 的网段</span>
<span class="token comment"># 应用到 kubenetes</span>
kubectl apply -f calico.yaml
<span class="token comment"># 查看所有 pods 的状态  Ready 表示安装成功</span>
<span class="token function">watch</span> kubectl get pods --all-namespaces

<span class="token punctuation">[</span>root@kubernetes-master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get node</span>
NAME                STATUS   ROLES    AGE   VERSION
kubernetes-master   Ready    master   25m   v1.18.2
kubernetes-node1    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   20m   v1.18.2
kubernetes-node2    Ready    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   19m   v1.18.2
</code></pre></div><h2 id="nfs数据卷"><a href="#nfs数据卷" class="header-anchor">#</a> NFS数据卷</h2> <p>为了使 Pod 在任何节点上都能够使用同一份持久化存储数据，我们需要使用网络存储的解决方案为 Pod 提供 数据卷。常用的网络存储方案有：NFS/cephfs/glusterfs</p> <h3 id="nfs服务器"><a href="#nfs服务器" class="header-anchor">#</a> NFS服务器</h3> <p><a href="/it/devops/Linux-CentOS.html#NFS网络存储">传送们</a></p> <h3 id="问题"><a href="#问题" class="header-anchor">#</a> 问题</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 若出现 MountVolume.SetUp failed for volume &quot;etcd-certs&quot; : secret &quot;etcd-certs&quot; not found</span>
<span class="token comment"># 则执行以下命令</span>
kubectl -n kube-system create secret generic etcd-certs --from-file<span class="token operator">=</span>/etc/kubernetes/pki/etcd/server.crt --from-file<span class="token operator">=</span>/etc/kubernetes/pki/etcd/server.key
</code></pre></div><h2 id="数据卷-定义-声明-使用"><a href="#数据卷-定义-声明-使用" class="header-anchor">#</a> 数据卷（定义/声明/使用）</h2> <p>存储管理与计算管理是两个不同的问题。Persistent Volume 子系统，对存储的供应和使用做了抽象，以 API 形式提供给管理员和用户使用。</p> <p>要完成这一任务，我们引入了两个新的 API 资源：Persistent Volume（持久卷） 和 Persistent Volume Claim（持久卷消费者）。</p> <p>Persistent Volume（PV）是集群之中的一块网络存储。PV 跟 Volume (卷) 类似，不过会有独立于 Pod 的生命周期。</p> <p>Persistent Volume Claim (PVC) 是用户的一个请求。跟 Pod 类似，Pod 消费 Node 的资源，PVC 消费 PV 的资源。</p> <p>Claim 能够请求特定的尺寸和访问模式（例如可以加载一个读写，以及多个只读实例）</p> <h3 id="交互流程"><a href="#交互流程" class="header-anchor">#</a> 交互流程</h3> <p>PV 是集群的资源。PVC 是对这一资源的请求，也是对资源的所有权的检验。PV 和 PVC 之间的互动遵循如下的生命周期。</p> <p>供应： 集群管理员会创建一系列的 PV。这些 PV 包含了为集群用户提供的真实存储资源，它们可利用 Kubernetes API 来消费。</p> <p>绑定： 用户创建一个包含了容量和访问模式的持久卷申请。Master 会监听 PVC 的产生，并尝试根据请求内容查找匹配的 PV，并把 PV 和 PVC 进行绑定。用户能够获取满足需要的资源，并且在使用过程中可能超出请求数量。如果找不到合适的卷，这一申请就会持续处于非绑定状态，一直到出现合适的 PV。例如一个集群准备了很多的 50G 大小的持久卷，（虽然总量足够）也是无法响应 100G 的申请的，除非把 100G 的 PV 加入集群。</p> <p>使用： Pod 把申请作为卷来使用。集群会通过 PVC 查找绑定的 PV，并 Mount 给 Pod。对于支持多种访问方式的卷，用户在使用 PVC 作为卷的时候，可以指定需要的访问方式。一旦用户拥有了一个已经绑定的 PVC，被绑定的 PV 就归该用户所有了。用户的 Pods 能够通过在 Pod 的卷中包含的 PVC 来访问他们占有的 PV。</p> <p>释放： 当用户完成对卷的使用时，就可以利用 API 删除 PVC 对象了，而且他还可以重新申请。删除 PVC 后，对应的卷被视为 “被释放”，但是这时还不能给其他的 PVC 使用。之前的 PVC 数据还保存在卷中，要根据策略来进行后续处理。</p> <p>回收： PV 的回收策略向集群阐述了在 PVC 释放卷的时候，应如何进行后续工作。目前可以采用三种策略：保留，回收或者删除。保留策略允许重新申请这一资源。在持久卷能够支持的情况下，删除策略会同时删除持久卷以及 AWS EBS/GCE PD 或者 Cinder 卷中的存储内容。如果插件能够支持，回收策略会执行基础的擦除操作（rm -rf /thevolume/*），这一卷就能被重新申请了。</p> <h3 id="pv示例"><a href="#pv示例" class="header-anchor">#</a> PV示例</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># 设置容量 一般来说，PV 会指定存储容量。这里需要使用 PV 的 capcity 属性。</span>
  <span class="token comment"># 目前存储大小是唯一一个能够被申请的指标，今后会加入更多属性，例如 IOPS，吞吐能力等。</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
  <span class="token comment"># 访问模式 只要资源提供者支持，持久卷能够被用任何方式加载到主机上。每种存储都会有不同的能力，每个 PV 的访问模式也会被设置成为该卷所支持的特定模式。</span>
  <span class="token comment"># 例如 NFS 能够支持多个读写客户端，但是某个 NFS PV 可能会在服务器上以只读方式使用。</span>
  <span class="token comment"># 每个 PV 都有自己的一系列的访问模式，这些访问模式取决于 PV 的能力。访问模式的可选范围如下：</span>
  <span class="token comment"># ReadWriteOnce： 该卷能够以读写模式被加载到一个节点上 </span>
  <span class="token comment"># ReadOnlyMany： 该卷能够以只读模式加载到多个节点上 </span>
  <span class="token comment"># ReadWriteMany： 该卷能够以读写模式被多个节点同时加载 在 CLI 下，</span>
  <span class="token comment"># 访问模式缩写为：</span>
  <span class="token comment"># RWO： ReadWriteOnce </span>
  <span class="token comment"># ROX： ReadOnlyMany </span>
  <span class="token comment"># RWX： ReadWriteMany </span>
  <span class="token comment"># 另外，一个卷不论支持多少种访问模式，同时只能以一种访问模式加载。例如一个 GCE Persistent Disk 既能支持 ReadWriteOnce，也能支持 ReadOnlyMany。</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token comment"># 该卷能够以读写模式被多个节点同时加载</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token comment"># RecyclingPolicy（回收策略） 当前的回收策略可选值包括：</span>
  <span class="token comment"># Retain： 人工重新申请 </span>
  <span class="token comment"># Recycle： 基础擦除（rm-rf/thevolume/*） </span>
  <span class="token comment"># Delete： 相关的存储资产例如 AWS EBS，GCE PD 或者 OpenStack Cinder 卷一并删除 </span>
  <span class="token comment"># 目前，只有 NFS 和 HostPath 支持 Recycle 策略，AWS EBS、GCE PD 以及 Cinder 卷支持 Delete 策略。</span>
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Recycle
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>storageclass<span class="token punctuation">-</span>provisioner
  <span class="token key atrule">volumeMode</span><span class="token punctuation">:</span> Filesystem
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token comment"># NFS 服务端配置的路径</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/local/kubernetes/volumes/nginx&quot;</span>
    <span class="token comment"># NFS 服务端地址</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.3.130
    <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div><div class="language-text extra-class"><pre class="language-text"><code> 一个卷会处于如下阶段（Phase）之一：
Available： 可用资源，尚未被绑定到 PVC 上 
Bound： 该卷已经被绑定 
Released： PVC 已经被删除，但该资源尚未被集群回收 
Failed： 该卷的自动回收过程失败
</code></pre></div><h3 id="pvc示例"><a href="#pvc示例" class="header-anchor">#</a> PVC示例</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
  <span class="token comment">#storageClassName: nfs-storageclass-provisioner</span>
  <span class="token key atrule">volumeMode</span><span class="token punctuation">:</span> Filesystem
  <span class="token key atrule">volumeName</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>nginx
</code></pre></div><h2 id="常用服务列表"><a href="#常用服务列表" class="header-anchor">#</a> 常用服务列表</h2> <p>使用k8s 装配服务，关键在于对 k8s 对象的了解和熟练的使用。</p> <p>只需要一个 资源配置文件即可搞定，除此之外根本没有什么好讲的。</p> <h3 id="yaml文件的自动生成"><a href="#yaml文件的自动生成" class="header-anchor">#</a> yaml文件的自动生成</h3> <p><a href="https://k8syaml.com/" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="kuboard"><a href="#kuboard" class="header-anchor">#</a> Kuboard</h3> <p><a href="/it/devops/k8s/Kuboard">Kuboard--传送门</a></p> <h3 id="nginx"><a href="#nginx" class="header-anchor">#</a> Nginx</h3> <p><a href="/it/devops/k8s/Nginx">Ngnix--传送门</a></p> <h3 id="rabbitmq"><a href="#rabbitmq" class="header-anchor">#</a> RabbitMQ</h3> <p><a href="/it/devops/k8s/RabbitMQ">RabbitMQ--传送门</a></p> <h3 id="nacos"><a href="#nacos" class="header-anchor">#</a> Nacos</h3> <p><a href="/it/devops/k8s/Nacos">Nacos--传送门</a></p> <h2 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h2> <h3 id="修改默认端口范围"><a href="#修改默认端口范围" class="header-anchor">#</a> 修改默认端口范围</h3> <p>Kubernetes服务的NodePort的默认端口范围是30000-32767，某些场合下该限制不太使用，可以按如下步骤自定义端口范围。</p> <ol><li>编辑<code>vim /etc/kubernetes/manifests/kube-apiserver.yaml</code>文件，增加配置<code>--service-node-port-range=2-65535</code></li> <li>使用<code>docker ps</code> 命令找到<code>kube-apiserver</code>容器，再使用<code>docker restart &lt;ApiServer 容器 ID&gt;</code>即可生效</li></ol> <div><img src="https://gitlab.com/funuf/vuepress-blog-oss/raw/master/img/it/devops/kubernetes-port-range-update.png"></div> <h2 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h2> <h3 id="帮助命令"><a href="#帮助命令" class="header-anchor">#</a> 帮助命令</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm --help
kubectl --help
</code></pre></div><h3 id="查看版本"><a href="#查看版本" class="header-anchor">#</a> 查看版本</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubeadm version
kubectl version
</code></pre></div><h3 id="打印join-token"><a href="#打印join-token" class="header-anchor">#</a> 打印join token</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 生成token，供slave节点加入</span>
kubeadm token create --print-join-command
</code></pre></div><h3 id="所有命名空间"><a href="#所有命名空间" class="header-anchor">#</a> 所有命名空间</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 增加 --all-namespace</span>
kubectl get pod --all-namespace
</code></pre></div><h3 id="配置imagepullsecret"><a href="#配置imagepullsecret" class="header-anchor">#</a> 配置imagePullSecret</h3> <p><a href="https://www.cnblogs.com/ding2016/p/13384799.html" target="_blank" rel="noopener noreferrer">kubernetes配置imagePullSecrets秘钥来拉取镜像<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create secret docker-registry qcsd   --docker-server<span class="token operator">=</span>https://registry.cn-qingdao.aliyuncs.com/qcsd   --docker-username<span class="token operator">=</span>xxxxxx  --docker-password<span class="token operator">=</span>yyyyyy
</code></pre></div><h3 id="指定版本的kubelet-kubeadm-kubectl"><a href="#指定版本的kubelet-kubeadm-kubectl" class="header-anchor">#</a> 指定版本的kubelet/kubeadm/kubectl</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 查看已安装</span>
yum list installed <span class="token operator">|</span> <span class="token function">grep</span> kube

<span class="token comment"># 卸载</span>
yum remove kubelet kubeadm kubectl

<span class="token comment"># 安装</span>
yum <span class="token function">install</span> kubelet-1.18.2 kubeadm-1.18.2 kubectl -1.18.2
</code></pre></div><h3 id="查看集群信息"><a href="#查看集群信息" class="header-anchor">#</a> 查看集群信息</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl cluster-info
</code></pre></div><h3 id="查看资源实体"><a href="#查看资源实体" class="header-anchor">#</a> 查看资源实体</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># kubectl 没有 list命令</span>
<span class="token comment"># 简单查看</span>
kubectl get xxx
<span class="token comment"># 查看详情</span>
kubectl describe xxx
</code></pre></div><h3 id="显示更多信息"><a href="#显示更多信息" class="header-anchor">#</a> 显示更多信息</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 显示pod的更多信息，比如ip地址</span>
kubectl get pod -o wide 
</code></pre></div><h3 id="确定-apiversion"><a href="#确定-apiversion" class="header-anchor">#</a> 确定 apiVersion</h3> <p><a href="https://trstringer.com/kubernetes-apiversion/" target="_blank" rel="noopener noreferrer">传送门<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 查看k8s已经定义的实体，极其所在的分组</span>
kubectl api-resources

<span class="token comment"># 查看api所在分组的版本</span>
kubectl api-versions <span class="token operator">|</span> <span class="token function">grep</span> apps 
</code></pre></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <p><a href="https://kubernetes.io/docs/home/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.tutorialspoint.com/kubernetes/index.htm" target="_blank" rel="noopener noreferrer">Tutorials<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://kuboard.cn/learning/" target="_blank" rel="noopener noreferrer">Kuboard<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/ispeasant/article/details/108405488" target="_blank" rel="noopener noreferrer">卸载docker<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://zhuanlan.zhihu.com/p/384061373" target="_blank" rel="noopener noreferrer">安装k8s<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.jianshu.com/p/75091ad364c1" target="_blank" rel="noopener noreferrer">安装指定版本的kubeadm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/xinfuxuan4/article/details/101097358" target="_blank" rel="noopener noreferrer">使用journalctl 查看kubelet的日志<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="">k8s  master 上 报错The connection to the server 192.168.X.X:6443 was refused -did you specify…?</a></p> <p>直接重装集群：<code>kubeadm reset</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@node01 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
The connection to the server <span class="token number">192.168</span>.1.215:6443 was refused - did you specify the right <span class="token function">host</span> or port?
</code></pre></div><p><a href="https://blog.csdn.net/fei79534672/article/details/78710858" target="_blank" rel="noopener noreferrer">Kuboard部署好，无法通过master的ip:port进行访问，因为calico网络的问题<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/qq_43659763/article/details/108471497" target="_blank" rel="noopener noreferrer">k8s集群使用calico遇到的问题，报错内容如：“Readiness probe failed: caliconode is not ready: BIRD is not ready:<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://blog.csdn.net/ll837448792/article/details/96622375" target="_blank" rel="noopener noreferrer">busybox 1.28.3 无法解析域名<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://cloud.tencent.com/developer/article/1689059" target="_blank" rel="noopener noreferrer">更新一个10年有效期的 Kubernetes 证书<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a><script>
import Imgv from &amp;quot;../../.vuepress/components/imgv&amp;quot;; export default { components: { Imgv } }
</script><script>
import Bannerv from &amp;quot;../../.vuepress/components/bannerv&amp;quot;; export default { components: { Bannerv } }
</script></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">14 days ago</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/it/devops/Docker.html" class="prev">
        Docker
      </a></span> <span class="next"><a href="/it/devops/Jenkins.html">
        Jenkins
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9098f2d6.js" defer></script><script src="/assets/js/2.f664f0df.js" defer></script><script src="/assets/js/49.8746a81f.js" defer></script><script src="/assets/js/4.7d1e3a27.js" defer></script><script src="/assets/js/10.f82cd603.js" defer></script>
  </body>
</html>
